<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>學生招聘個案（體育運動）</title>

  <!-- ✅ Cross-platform: load the same font everywhere (NO redesign) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0F172A;
      --surface:#1E293B;
      --card:#1E293B;
      --muted:#94A3B8;
      --text:#F8FAFC;
      --heading:#F8FAFC;
      --ring:#334155;
      --accent:#38BDF8;
      --accentHover:#0EA5E9;
      --shadow:0 8px 22px rgba(0,0,0,.45);
      --radius:16px;
      --modalBg:rgba(0,0,0,.65);
      --tagBg:#1E293B;
      --tagBorder:#334155;
      --tagText:#F8FAFC;

      --rangeFill: var(--accent);
      --rangeRest: #ffffff;
      --rangeBorder: rgba(56,189,248,.75);
      --thumbBorder: rgba(255,255,255,.88);
      --thumbShadow: 0 8px 18px rgba(0,0,0,.45);
      --rangeHeight: 16px;
      --trackHeight: 6px;
      --thumbSize: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif, -apple-system, "Noto Sans TC", system-ui, "PingFang TC", "Microsoft JhengHei", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:
        radial-gradient(900px 400px at 10% -10%, rgba(56,189,248,.16) 0%, rgba(56,189,248,0) 60%),
        radial-gradient(800px 500px at 110% 0%, rgba(14,165,233,.14) 0%, rgba(14,165,233,0) 55%),
        var(--bg);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .container{max-width:1200px; margin:26px auto 80px; padding:0 20px;}

    header{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin-bottom:14px;flex-wrap:wrap;}
    .title{display:flex;align-items:center;gap:10px;}
    .title h1{
      margin:0; font-size:clamp(20px,2.3vw,28px); letter-spacing:.4px;
      background:linear-gradient(90deg,var(--heading),var(--accent));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    .toolbar{display:flex;gap:10px;align-items:center;justify-content:flex-end;flex-wrap:wrap;}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:10px 14px;border-radius:12px;border:1px solid var(--ring);
      background:var(--card);color:var(--text);cursor:pointer;
      transition:transform .06s ease, border-color .2s, background .2s;
      box-shadow:var(--shadow);white-space:nowrap;font-size:14px;
    }
    .btn:hover{border-color:var(--accent);background:var(--surface);}
    .btn:active{transform:scale(.98);}
    .filter-btn{display:none;}
    .desktop-only{display:inline-flex;}

    .filter-icon{display:inline-flex;width:16px;height:16px;margin-right:6px;}
    .filter-icon svg{width:100%;height:100%;}
    .filter-icon path{stroke:var(--text) !important;}

    .apply-btn{
      padding:8px 16px;border-radius:999px;border:none;background:var(--accent);
      color:#0F172A;font-size:14px;cursor:pointer;text-decoration:none;
      display:inline-flex;align-items:center;justify-content:center;
      box-shadow:var(--shadow);
      transition:background .15s ease, transform .06s ease, box-shadow .15s ease;
      white-space:nowrap;flex:0 0 auto;
    }
    .apply-btn:hover{background:var(--accentHover);}
    .apply-btn:active{transform:scale(.97);box-shadow:0 4px 14px rgba(56,189,248,.35);}

    .modal header .apply-btn{margin-right:40px;}

    .filter-row{margin:16px 0 12px;}
    .filters{display:grid;gap:10px;grid-template-columns:1.1fr 1.1fr 1fr 1fr;}
    .search-row{display:grid;grid-template-columns:1.1fr 1.1fr;gap:10px;margin:10px 0 10px;}

    .filters .field,.search-row .field{display:flex;flex-direction:column;gap:6px}
    .label{font-size:12px;color:var(--muted)}
    .mini{font-size:12px;color:var(--muted)}

    select,input[type="search"],input[type="text"]{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);
      background:var(--card);color:var(--text);box-shadow:var(--shadow);
      outline:none;transition:border-color .2s, box-shadow .2s;font-size:14px;
    }
    select:focus,input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(56,189,248,.22)}
    input::placeholder{color:rgba(148,163,184,.85);}

    #district,#q,#idq,#sortDate,#genderPref{
      background:#ffffff;
      color:#0F172A;
    }
    #q::placeholder,#idq::placeholder{color:rgba(15,23,42,.45);}

    .slider-row{display:flex;gap:16px;align-items:flex-start}
    .slider-col{display:flex;flex-direction:column;gap:6px;flex:1}

    input[type="range"]{
      width:100%;
      height: var(--rangeHeight);
      background: transparent;
      padding:0;
      margin:0;
      appearance:none;
      -webkit-appearance:none;
      --pct: 0%;
    }
    input[type="range"]:focus{outline:none}

    input[type="range"]::-webkit-slider-runnable-track{
      height: var(--trackHeight);
      border-radius:999px;
      border:1px solid var(--rangeBorder);
      background: linear-gradient(
        90deg,
        var(--rangeFill) 0%,
        var(--rangeFill) var(--pct),
        var(--rangeRest) var(--pct),
        var(--rangeRest) 100%
      );
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width: var(--thumbSize);
      height: var(--thumbSize);
      border-radius:999px;
      background: var(--rangeFill);
      border:2px solid var(--thumbBorder);
      box-shadow: var(--thumbShadow);
      margin-top: calc((var(--trackHeight) - var(--thumbSize)) / 2);
    }
    #feeMin::-webkit-slider-thumb,
    #feeMax::-webkit-slider-thumb{ margin-top:-6px; }

    input[type="range"]::-moz-range-track{
      height: var(--trackHeight);
      border-radius:999px;
      border:1px solid var(--rangeBorder);
      background: linear-gradient(
        90deg,
        var(--rangeFill) 0%,
        var(--rangeFill) var(--pct),
        var(--rangeRest) var(--pct),
        var(--rangeRest) 100%
      );
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    input[type="range"]::-moz-range-thumb{
      width: var(--thumbSize);
      height: var(--thumbSize);
      border-radius:999px;
      background: var(--rangeFill);
      border:2px solid var(--thumbBorder);
      box-shadow: var(--thumbShadow);
    }
    input[type="range"]::-moz-range-progress{
      height: var(--trackHeight);
      border-radius:999px;
      background: transparent;
    }

    input[type="range"]::-ms-track{
      height: var(--trackHeight);
      border-radius:999px;
      border-color:transparent;
      color:transparent;
      background:transparent;
    }

    #feeBand{
      display:none;width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);
      background:#ffffff;box-shadow:var(--shadow);color:#0F172A;
    }

    .meta{display:flex;align-items:center;gap:10px;margin:10px 2px 18px;color:var(--muted);font-size:14px;}

    .active-bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0 16px;}
    .hidden{display:none}
    .chip{
      display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:6px 10px;border-radius:999px;
      border:1px solid var(--tagBorder);background:var(--tagBg);color:var(--tagText);box-shadow:var(--shadow);
    }
    .chip .x{border:none;background:transparent;cursor:pointer;font-size:14px;line-height:1;color:var(--accent);padding:0 2px 0 0;}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr);}}
    @media (max-width:560px){.grid{grid-template-columns:1fr;}}

    .card{
      background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);
      padding:16px;box-shadow:var(--shadow);
      transition:transform .15s ease, border-color .2s;cursor:pointer;
    }
    .card:hover{transform:translateY(-3px);border-color:rgba(56,189,248,.55)}
    .card:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(56,189,248,.25)}
    .top{display:flex;align-items:center;gap:12px;margin-bottom:10px;}
    .avatar{
      width:38px;height:38px;border-radius:50%;display:grid;place-items:center;color:#fff;font-weight:800;letter-spacing:.5px;
      border:1px solid rgba(255,255,255,.08);
    }
    .who{display:flex;flex-direction:column;gap:3px;}
    .who .name{font-weight:700}
    .who .muted{color:var(--muted);font-size:13px}
    .who .name small{color:var(--muted)!important;}

    .row{display:flex;align-items:center;gap:8px;margin:8px 0;color:var(--text);font-size:14px}
    .row svg{opacity:.95}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
    .tag{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--tagBorder);background:var(--tagBg);color:var(--tagText);}
    .foot{margin-top:12px;display:flex;align-items:center;justify-content:space-between;gap:8px;color:var(--muted);font-size:13px;}
    .budget{color:var(--text);font-weight:700;}
    .note{margin-top:10px;color:var(--text);font-size:14px;line-height:1.5;opacity:.9}
    .empty{grid-column:1/-1;text-align:center;padding:40px 16px;color:var(--muted);border:1px dashed var(--ring);border-radius:var(--radius);background:var(--surface)}

    .modal-backdrop{
      position:fixed;inset:0;background:var(--modalBg);
      display:none;align-items:center;justify-content:center;
      z-index:50;padding:16px;
    }
    .modal-backdrop.show{display:flex}
    .modal{
      width:min(920px,96vw);max-height:90vh;overflow:auto;background:var(--surface);
      border:1px solid var(--ring);border-radius:22px;
      box-shadow:0 25px 70px rgba(0,0,0,.55);
      position:relative;color:var(--text);
    }
    .modal header{
      padding:18px 20px 0 20px;display:flex;align-items:flex-start;justify-content:space-between;gap:10px;position:relative;
    }
    .modal .body{padding:4px 20px 20px}
    .modal .close{border:none;background:transparent;color:var(--muted);cursor:pointer;font-size:22px;position:absolute;top:14px;right:18px;}

    .profile-grid{display:grid;grid-template-columns:1.2fr 1fr;gap:18px;margin-top:6px;justify-items:stretch;}
    .profile-card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:14px;}
    .profile-title{margin:0 0 8px 0;font-size:15px;color:var(--heading)}
    .kv{display:grid;grid-template-columns:120px 1fr;gap:8px 12px;font-size:14px}
    .kv b{color:var(--heading);font-weight:600}
    .cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .copy{
      cursor:pointer;border:1px solid var(--ring);background:var(--card);color:var(--text);
      padding:8px 10px;border-radius:10px;box-shadow:var(--shadow)
    }
    .copy:hover{border-color:rgba(56,189,248,.55);background:var(--surface)}
    #copyId.copy{background:#ffffff;color:#0F172A;}

    @media (max-width:560px){
      .profile-grid{grid-template-columns:1fr;justify-items:center;}
      .profile-card{max-width:520px;width:100%;}
    }

    .pager{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:16px;flex-wrap:wrap}
    .pagebtn{
      border:1px solid rgba(255,255,255,.18);
      background:#ffffff;color:#0F172A;
      padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow);
    }
    .pagebtn:hover{background:#f1f5f9;}
    .pagebtn[disabled]{opacity:.5;cursor:not-allowed}
    .pageinfo{font-size:13px;color:var(--text)}

    .subgrid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px 12px;margin-top:10px;}
    .subgrid label{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--text)}
    .subgrid input{width:16px;height:16px}
    .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
    .fw{width:100%}
    .fee-label{}

    @media (max-width:560px){
      .toolbar{
        width:100%;
        display:grid;
        grid-template-columns:repeat(2,minmax(0,1fr));
        gap:8px;margin-top:8px;
      }
      .toolbar .btn{width:100%;}
      #resetAll{grid-column:1/-1;}
      .filter-btn{display:inline-flex;}
      .desktop-only{display:none;}

      .search-row{display:flex;gap:8px;margin:10px 0 10px;}
      .search-row .field{flex:1;}
    }

    .toolbar .btn{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.18);}
    .toolbar .btn:hover{background:rgba(255,255,255,.10);border-color:rgba(56,189,248,.55);}

    .filter-panel{
      width:100%;max-width:640px;margin:0 auto;background:var(--surface);
      border-radius:18px 18px 0 0;
      box-shadow:0 -16px 40px rgba(0,0,0,.75);
      border:1px solid var(--ring);
    }
    .filter-header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px 6px;}
    .filter-title{margin:0;font-size:18px;color:var(--heading);}
    .filter-header-right{display:flex;align-items:center;gap:8px;}

    .filter-apply-btn{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid rgba(56,189,248,.55);
      background: var(--accent);
      color:#0F172A;
      font-size:14px;
      cursor:pointer;
      white-space:nowrap;
      box-shadow: var(--shadow);
      transition:background .15s ease, border-color .15s ease, transform .06s ease;
    }
    .filter-apply-btn:hover{
      background:var(--accentHover);
      border-color: rgba(56,189,248,.85);
    }
    .filter-apply-btn:active{ transform:scale(.98); }

    #sportSelAll,
    #sportClrAll,
    #applySport{
      border:1px solid rgba(56,189,248,.55);
      background: var(--accent);
      color:#0F172A;
    }
    #sportSelAll:hover,
    #sportClrAll:hover,
    #applySport:hover{
      background:var(--accentHover);
      border-color: rgba(56,189,248,.85);
    }

    .filter-close{border:none;background:transparent;font-size:24px;cursor:pointer;color:var(--muted);}
    .filter-body{padding:4px 18px 14px;}

    @media (max-width:560px){
      #filterBackdrop.modal-backdrop{align-items:flex-end;justify-content:center;padding:0;}
      .filters{display:none;}
      .filter-panel .filters{
        display:grid;
        grid-template-columns:1fr;
        gap:10px;
        margin:6px 0 6px;
      }
      .fee-label{font-size:0;}
      .fee-label::before{content:"價位區間";font-size:12px;color:var(--muted);}
      .slider-row,#feeLabel{display:none;}
      #feeBand{display:block;}
      .subgrid{grid-template-columns:1fr;max-height:260px;overflow-y:auto;padding-right:4px;}
      .subgrid label{align-items:center;}
      .subgrid label span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    }

    @media (min-width:561px){
      .filter-btn{display:none;}
      .desktop-only{display:inline-flex;}
      #filterBackdrop{display:none !important;}
      .filters{display:grid;}

      .filter-row{
        display:grid;
        grid-template-columns:1.1fr 1.1fr 1.1fr 1.1fr 1fr 1fr;
        gap:10px;align-items:flex-start;margin:16px 0 12px;
      }
      .filter-row .filters,.filter-row .search-row{display:contents;margin:0;}
      .filter-row .label,.filter-row .mini{white-space:nowrap;}
      .filter-row .filters .field:nth-child(1){grid-column:1;grid-row:1;}
      .filter-row .filters .field:nth-child(2){grid-column:2;grid-row:1;}
      .filter-row .filters .field:nth-child(3){grid-column:5;grid-row:1;}
      .filter-row .filters .field:nth-child(4){grid-column:6;grid-row:1;}
      .filter-row .search-row .field:nth-child(1){grid-column:3;grid-row:1;}
      .filter-row .search-row .field:nth-child(2){grid-column:4;grid-row:1;}
    }

    .filter-row .label,.filter-row .mini{white-space:nowrap;}

    .banner{
      position:relative;width:100%;border-radius:22px;overflow:hidden;
      padding:22px 20px;margin-bottom:14px;
      border:1.2px solid transparent;
      background:
        radial-gradient(700px 220px at 12% 20%, rgba(56,189,248,.22), transparent 62%) padding-box,
        radial-gradient(520px 220px at 85% 35%, rgba(14,165,233,.18), transparent 65%) padding-box,
        linear-gradient(135deg, var(--surface) 0%, var(--bg) 45%, var(--surface) 100%) padding-box,
        linear-gradient(135deg, rgba(56,189,248,.85) 0%, rgba(14,165,233,.65) 55%, rgba(56,189,248,.55) 100%) border-box;
      box-shadow:0 10px 26px rgba(0,0,0,.55), 0 1px 0 rgba(255,255,255,.06) inset;
    }
    .banner::before{
      content:"";position:absolute;inset:1px;border-radius:21px;
      background:
        radial-gradient(520px 200px at 18% 10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(420px 220px at 85% 0%, rgba(255,255,255,.08), transparent 62%);
      opacity:.55;pointer-events:none;
    }
    .banner::after{
      content:"";position:absolute;inset:1px;border-radius:21px;
      background:linear-gradient(180deg, transparent 55%, rgba(0,0,0,.35) 100%);
      pointer-events:none;
    }
    .banner-inner{position:relative;display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap;}
    .banner-title{display:flex;align-items:center;gap:12px;min-width:280px;}
    .logo-wrap{
      width:46px;height:46px;border-radius:14px;display:grid;place-items:center;
      background:rgba(30,41,59,.65);border:1px solid rgba(51,65,85,.9);
      box-shadow:0 8px 18px rgba(0,0,0,.55);
      backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);position:relative;
    }
    .logo-wrap::before{
      content:"";position:absolute;inset:-10px;border-radius:18px;
      background:radial-gradient(circle at 50% 50%, rgba(56,189,248,.18), transparent 62%);
      pointer-events:none;
    }
    .book{width:28px;height:28px;position:relative;z-index:1;}
    .book path{stroke:var(--accent);stroke-width:1.7;stroke-linecap:round;stroke-linejoin:round;}
    .book{
      filter:drop-shadow(0 6px 12px rgba(0,0,0,.55))
             drop-shadow(0 0 10px rgba(56,189,248,.18));
    }
    .banner-text h1{
      margin:0;font-size:clamp(22px,2.5vw,30px);letter-spacing:.3px;line-height:1.08;color:var(--heading);
    }
    .banner-text h1 .accent{color:var(--heading);font-weight:900;}
    .banner-text p{margin:7px 0 0;color:rgba(148,163,184,.92);font-size:13.5px;line-height:1.45;max-width:680px;}

    @media (min-width:981px){
      .banner{padding:30px 28px;margin-bottom:26px;}
      .banner-inner{flex-direction:column;align-items:flex-start;}
      .toolbar{width:100%;justify-content:flex-start;margin-top:14px;}
    }

    #mobileSportBtn{
      width:100%;
      justify-content:flex-start;
      text-align:left;
      background:#FFFFFF;
      color:#0f172a;
      border:1px solid rgba(255,255,255,.18);
      border-radius:12px;
      padding:10px 12px;
      box-shadow:var(--shadow);
    }
    #mobileSportBtn:hover{background:#f1f5f9;border-color:rgba(255,255,255,.30);}

    /* =========================================================
       ✅ Cross-platform consistency patch (NO redesign)
       ========================================================= */

    html{
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    button, input, select, textarea{
      font-family: inherit;
    }

    input[type="search"]{
      -webkit-appearance:none;
      appearance:none;
    }
    input[type="search"]::-webkit-search-decoration,
    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-results-button,
    input[type="search"]::-webkit-search-results-decoration{
      -webkit-appearance:none;
    }

    input[type="range"]{
      touch-action:none;
    }

    @supports (-webkit-touch-callout: none){
      @media (max-width:560px){
        #district,#q,#idq,#sortDate,#genderPref,#feeBand{
          font-size:16px;
        }
      }

      #district,#sortDate,#genderPref,#feeBand{
        -webkit-appearance:none;
        appearance:none;
        padding-right:34px;

        background-color:#ffffff;
        background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5' fill='none' stroke='%230F172A' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat:no-repeat;
        background-position:right 10px center;
        background-size:18px 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="banner">
      <div class="banner-inner">
        <div class="banner-title">
          <span class="logo-wrap" aria-hidden="true">
            <svg class="book" viewBox="0 0 24 24" fill="none">
              <path d="M8 4h8v3a4 4 0 0 1-8 0V4Z" opacity=".95"/>
              <path d="M6 4h12v2a6 6 0 0 1-12 0V4Z"/>
              <path d="M6 6H4a2 2 0 0 0 2 2" opacity=".9"/>
              <path d="M18 6h2a2 2 0 0 1-2 2" opacity=".9"/>
              <path d="M12 11v3" opacity=".9"/>
              <path d="M9 20h6" opacity=".95"/>
              <path d="M10 14h4l1 6H9l1-6Z"/>
            </svg>
          </span>

          <div class="banner-text">
            <h1>招聘個案 <span class="accent">（體育）</span></h1>
            <p>推廣體育運動，幫助學生找到適合的教練</p>
          </div>
        </div>

        <div class="toolbar">
          <button id="filterOpen" class="btn filter-btn">
            <span class="filter-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M4 5h16M7 11h10M10 17h4" stroke="#0f172a" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            篩選
          </button>

          <button id="sportBtn" class="btn desktop-only">運動種類篩選</button>
          <button id="shuffle" class="btn">重新隨機</button>
          <button id="resetAll" class="btn">重設所有篩選</button>
        </div>
      </div>
    </div>

    <section class="filter-row" aria-label="篩選與搜尋">
      <div class="filters" aria-label="篩選條件">
        <div class="field">
          <span class="label">上課及授課地區 / 網上授課</span>
          <select id="district">
            <option value="">全部地區</option>
            <option>網上授課</option>
            <option>中西區</option><option>灣仔區</option><option>東區</option><option>南區</option>
            <option>油尖旺區</option><option>深水埗區</option><option>九龍城區</option><option>黃大仙區</option><option>觀塘區</option>
            <option>葵青區</option><option>荃灣區</option><option>屯門區</option><option>元朗區</option><option>北區</option><option>大埔區</option>
            <option>沙田區</option><option>西貢區</option><option>離島區</option>
          </select>
        </div>

        <div class="field">
          <span class="label fee-label">價位區間（HK$/時）</span>
          <div class="slider-row">
            <div class="slider-col">
              <span class="mini">價位下限</span>
              <input id="feeMin" type="range" min="0" max="500" step="10" />
            </div>
            <div class="slider-col">
              <span class="mini">價位上限</span>
              <input id="feeMax" type="range" min="0" max="500" step="10" />
            </div>
          </div>
          <div class="label" id="feeLabel">HK$ 0 – 500</div>

          <select id="feeBand">
            <option value="">全部價位</option>
            <option value="0-100">HK$0–100/小時</option>
            <option value="100-200">HK$100–200/小時</option>
            <option value="200-300">HK$200–300/小時</option>
            <option value="300-400">HK$300–400/小時</option>
            <option value="400+">HK$400以上/小時</option>
          </select>
        </div>

        <div class="field">
          <span class="label">張貼日期排序</span>
          <select id="sortDate">
            <option value="desc">最近 → 最久</option>
            <option value="asc">最久 → 最近</option>
            <option value="rand">隨機時間排序</option>
          </select>
        </div>

        <div class="field">
          <span class="label">導師性別偏好</span>
          <select id="genderPref">
            <option value="">不限導師性別</option>
            <option value="male">男導師</option>
            <option value="female">女導師</option>
          </select>
        </div>
      </div>

      <div class="search-row" aria-label="搜尋">
        <div class="field">
          <span class="label">關鍵字搜尋</span>
          <input id="q" type="search" placeholder="姓名 / 年齡 / 經驗 / 備註…" />
        </div>

        <div class="field">
          <span class="label">案件編號搜尋</span>
          <input id="idq" type="text" placeholder="輸入案件編號（如：SC-202511-003）" />
        </div>
      </div>
    </section>

    <div id="activeBar" class="active-bar hidden" aria-live="polite"></div>
    <div class="meta" id="count">載入中…</div>
    <section id="grid" class="grid" aria-live="polite" aria-busy="true"></section>

    <div class="pager">
      <button id="prevPage" class="pagebtn">上一頁</button>
      <span id="pageInfo" class="pageinfo">第 1 / 1 頁</span>
      <button id="nextPage" class="pagebtn">下一頁</button>
    </div>
  </div>

  <div id="backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <header>
        <div class="title" style="gap:10px">
          <div id="modalAvatar" class="avatar" style="width:44px;height:44px"></div>
          <div>
            <h2 id="modalTitle" style="margin:0; font-size:20px"></h2>
            <div id="modalSub" class="who muted" style="margin-top:4px"></div>
          </div>
        </div>

        <a href="https://forms.gle/pXgGyQMeqcuSinKa7" target="_blank" rel="noopener noreferrer" class="apply-btn">
          立即申請！
        </a>

        <button class="close" id="modalClose" aria-label="關閉">✕</button>
      </header>
      <div class="body">
        <div class="profile-grid">
          <div class="profile-card">
            <h3 class="profile-title">基本資料</h3>
            <div class="kv" id="kv-basic"></div>
            <div class="cta-row">
              <button id="copyId" class="copy">複製案件編號</button>
            </div>
          </div>
          <div class="profile-card">
            <h3 class="profile-title">課程期望</h3>
            <div class="kv" id="kv-expect"></div>
          </div>
          <div class="profile-card" style="grid-column:1/-1">
            <h3 class="profile-title">備註 / 目標</h3>
            <div id="kv-notes" style="white-space:pre-wrap; line-height:1.7; font-size:14px"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="sportBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="sportTitle">
      <header>
        <h2 id="sportTitle" style="margin:0; font-size:20px; color:var(--heading)">運動種類篩選</h2>
        <button class="close" id="sportClose" aria-label="關閉">✕</button>
      </header>
      <div class="body">
        <div class="mini">勾選運動（可複選）；未勾選即不限運動種類</div>
        <div id="sportList" class="subgrid" style="margin-top:12px"></div>
        <div class="bar">
          <button id="sportSelAll" class="btn">全選</button>
          <button id="sportClrAll" class="btn">清除全部</button>
          <span id="sportSelCount" class="mini fw">已選：0 種運動</span>
        </div>
        <div class="bar" style="justify-content:flex-end; margin-top:12px">
          <button id="applySport" class="btn">套用篩選</button>
        </div>
      </div>
    </div>
  </div>

  <div id="filterBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="filter-panel" role="document" aria-labelledby="filterTitle">
      <div class="filter-header">
        <h2 id="filterTitle" class="filter-title">篩選條件</h2>
        <div class="filter-header-right">
          <button id="filterApply" class="filter-apply-btn">套用篩選</button>
          <button id="filterClose" class="filter-close" aria-label="關閉">✕</button>
        </div>
      </div>
      <div class="filter-body" id="filterPanelBody">
        <div class="field mobile-sport-row" id="mobileSportRow">
          <span class="label">運動種類篩選</span>
          <button id="mobileSportBtn" class="btn">開啟運動種類篩選</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SPORTS = ["游泳","羽毛球","乒乓球","足球","籃球","排球","網球","跆拳道","空手道","武術","田徑","體操","舞蹈","攀石","跳繩","其他"];

    const CASES = [
      {id:"SC-202511-001",name:"神秘的熊貓",age:"12",sports:["游泳"],experience:"初學，會換氣，想學自由式與蛙式",
        district:"沙田區",venue:"學生提供場地",fee:260,weeklyLessons:2,lessonLength:1,tutorGenderPref:"皆可",
        notes:"希望三個月內能完成 25m 自由式與蛙式；怕冷，偏好室內池。",startDate:"即時",schedule:"週末上午",postedDate:"2025-11-23"},
      {id:"SC-202511-002",name:"Kelly",age:"9",sports:["舞蹈"],experience:"學校舞蹈社一年，基本柔軟度一般",
        district:"網上授課",venue:"導師提供場地",fee:200,weeklyLessons:2,lessonLength:1,tutorGenderPref:"女",
        notes:"想加強基本功與節奏感，準備校內表演。",startDate:"12 月",schedule:"二四 18:30",postedDate:"2025-11-21"},
      {id:"SC-202510-003",name:"Leo",age:"15",sports:["籃球"],experience:"打校隊替補，控球與防守待提升",
        district:"觀塘區",venue:"學生提供場地",fee:280,weeklyLessons:2,lessonLength:1.5,tutorGenderPref:"男",
        notes:"希望提升一對一防守與投籃穩定度；目標升上先發。",startDate:"即時",schedule:"平日 19:00 後",postedDate:"2025-10-28"},
      {id:"SC-202511-004",name:"Carmen",age:"11",sports:["羽毛球"],experience:"初學，握拍與步法基礎薄弱",
        district:"油尖旺區",venue:"導師提供場地",fee:240,weeklyLessons:2,lessonLength:1,tutorGenderPref:"皆可",
        notes:"想參加校際賽，提升發球與接吊球判斷。",startDate:"可議",schedule:"週末下午",postedDate:"2025-11-18"},
      {id:"SC-202509-005",name:"Ivan",age:"17",sports:["田徑"],experience:"100m/200m 短跑，PB 12.6s",
        district:"葵青區",venue:"學生提供場地",fee:320,weeklyLessons:2,lessonLength:1.5,tutorGenderPref:"男",
        notes:"需要起跑與後程速度維持訓練；期望半年內進步 0.6s。",startDate:"即時",schedule:"三五 晚上",postedDate:"2025-09-12"},
      {id:"SC-202511-006",name:"Mandy",age:"8",sports:["乒乓球"],experience:"基礎拍面控制，正手推擋尚可",
        district:"九龍城區",venue:"導師提供場地",fee:220,weeklyLessons:2,lessonLength:1,tutorGenderPref:"皆可",
        notes:"提升正手攻球與腳步移位，偏好遊戲式教學。",startDate:"12/10",schedule:"一三 17:30",postedDate:"2025-11-22"},
      {id:"SC-202510-007",name:"Oscar",age:"14",sports:["足球"],experience:"右邊鋒，速度快，傳中與對抗弱",
        district:"荃灣區",venue:"學生提供場地",fee:300,weeklyLessons:2,lessonLength:1.5,tutorGenderPref:"男",
        notes:"希望改善身體對抗與傳中準度，準備 U15 聯賽。",startDate:"即時",schedule:"週末下午",postedDate:"2025-10-06"},
      {id:"SC-202512-008",name:"Joey",age:"10",sports:["體操"],experience:"零基礎",
        district:"灣仔區",venue:"導師提供場地",fee:260,weeklyLessons:1,lessonLength:1,tutorGenderPref:"皆可",
        notes:"以基礎柔軟與核心為主，循序安全。",startDate:"12 月",schedule:"六 上午",postedDate:"2025-12-01"},
      {id:"SC-202508-009",name:"Tommy",age:"13",sports:["跆拳道"],experience:"黃帶，腿法力量不足",
        district:"離島區",venue:"學生提供場地",fee:230,weeklyLessons:2,lessonLength:1,tutorGenderPref:"男",
        notes:"希望升綠帶，強化品勢與對打反應。",startDate:"可議",schedule:"二四 晚間",postedDate:"2025-08-30"},
      {id:"SC-202511-010",name:"Yuki",age:"16",sports:["網球"],experience:"中級，反拍弱點明顯",
        district:"中西區",venue:"導師提供場地",fee:360,weeklyLessons:1,lessonLength:2,tutorGenderPref:"男",
        notes:"增強上旋反拍與發球穩定；期望參加公開賽。",startDate:"即時",schedule:"週日 下午",postedDate:"2025-11-20"},
      {id:"SC-202507-011",name:"Jason",age:"7",sports:["空手道"],experience:"初學",
        district:"元朗區",venue:"學生提供場地",fee:200,weeklyLessons:2,lessonLength:1,tutorGenderPref:"皆可",
        notes:"基本禮儀、站姿與基本手技；重視專注力養成。",startDate:"12/05",schedule:"二四 17:00",postedDate:"2025-07-15"},
      {id:"SC-202511-012",name:"Suki",age:"18",sports:["武術","舞蹈"],experience:"武術長拳一年，舞蹈零基礎",
        district:"沙田區",venue:"導師提供場地",fee:520,weeklyLessons:2,lessonLength:1.5,tutorGenderPref:"女",
        notes:"希望結合身段與基本功，準備舞台演出。",startDate:"即時",schedule:"平日 晚上",postedDate:"2025-11-23"}
    ];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    function esc(str){
      return String(str ?? "").replace(/[&<>"'=\/`]/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'
      }[s]));
    }
    function colorFromName(name){
      let h=0;
      for(let i=0;i<name.length;i++) h = (h*31 + name.charCodeAt(i)) % 360;
      return `hsl(${h} 70% 50%)`;
    }
    function scrollToTop(){ try{window.scrollTo({top:0,behavior:'smooth'});}catch{window.scrollTo(0,0);} }
    function parseISODate(s){
      if(!s || typeof s!=='string') return null;
      const m=s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if(!m) return null;
      const dt=new Date(Date.UTC(+m[1],+m[2]-1,+m[3]));
      return isNaN(dt.getTime())?null:dt;
    }
    function tsOf(c){ const d=parseISODate(c.postedDate); return d?d.getTime():0; }
    function fmtDate(ts,fallback){
      if(!ts) return fallback||"—";
      const d=new Date(ts);
      return `${d.getUTCFullYear()}/${String(d.getUTCMonth()+1).padStart(2,'0')}/${String(d.getUTCDate()).padStart(2,'0')}`;
    }
    async function copyTextFallback(text){
      const ta=document.createElement('textarea');
      ta.value=text; ta.setAttribute('readonly',''); ta.style.position='fixed'; ta.style.opacity='0';
      document.body.appendChild(ta); ta.select();
      let ok=false; try{ ok=document.execCommand('copy'); }catch(e){ ok=false; }
      document.body.removeChild(ta); return ok;
    }
    async function copyToClipboard(text){
      try{
        if(navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text); return true;
        }
      }catch(e){}
      return await copyTextFallback(text);
    }

    const grid=document.getElementById('grid');
    const countEl=document.getElementById('count');
    const q=document.getElementById('q');
    const idq=document.getElementById('idq');
    const districtSel=document.getElementById('district');
    const feeMin=document.getElementById('feeMin');
    const feeMax=document.getElementById('feeMax');
    const feeLabel=document.getElementById('feeLabel');
    const feeBand=document.getElementById('feeBand');
    const genderPrefSel=document.getElementById('genderPref');
    const activeBar=document.getElementById('activeBar');
    const sortDateSel=document.getElementById('sortDate');

    const backdrop=document.getElementById('backdrop');
    const modalClose=document.getElementById('modalClose');
    const modalAvatar=document.getElementById('modalAvatar');
    const modalTitle=document.getElementById('modalTitle');
    const modalSub=document.getElementById('modalSub');
    const kvBasic=document.getElementById('kv-basic');
    const kvExpect=document.getElementById('kv-expect');
    const kvNotes=document.getElementById('kv-notes');
    const copyIdBtn=document.getElementById('copyId');

    const PAGE_SIZE=9;
    const prevPageBtn=document.getElementById('prevPage');
    const nextPageBtn=document.getElementById('nextPage');
    const pageInfo=document.getElementById('pageInfo');

    const sportBtn=document.getElementById('sportBtn');
    const sportBackdrop=document.getElementById('sportBackdrop');
    const sportClose=document.getElementById('sportClose');
    const sportList=document.getElementById('sportList');
    const sportSelAll=document.getElementById('sportSelAll');
    const sportClrAll=document.getElementById('sportClrAll');
    const sportSelCount=document.getElementById('sportSelCount');
    const applySport=document.getElementById('applySport');

    const filterBackdrop=document.getElementById('filterBackdrop');
    const filterOpenBtn=document.getElementById('filterOpen');
    const filterCloseBtn=document.getElementById('filterClose');
    const filterApplyBtn=document.getElementById('filterApply');
    const filterPanelBody=document.getElementById('filterPanelBody');

    const mobileSportRow=document.getElementById('mobileSportRow');
    const mobileSportBtn=document.getElementById('mobileSportBtn');

    const filtersSection=document.querySelector('.filters');
    const filtersHomeParent=filtersSection.parentNode;
    const filtersHomeNextSibling=filtersSection.nextElementSibling;

    const mobileSportHomeParent = mobileSportRow.parentNode;
    const mobileSportHomeNextSibling = mobileSportRow.nextElementSibling;

    let currentPage=1;
    let data=CASES.slice();
    data.forEach(c=>{c._ts=tsOf(c); c._dateStr=fmtDate(c._ts, esc(c.postedDate||'—'));});
    let view=data.slice();

    /* ✅ CHANGED (as ordered): when in 篩選頁, sports selection is draft-only until 套用篩選 */
    const sportsSelected=new Set();   // committed (applied) sports
    let sheetSports=null;            // draft sports while filter sheet is open

    let filtersInSheet=false;
    let inFilterSheet=false;
    let sheetSnapshot=null;

    let sportDraft=null;
    let returnToFilterAfterSport=false;

    let feeMinTouched=false;
    let feeMaxTouched=false;

    function pctOfRange(el){
      const min=Number(el.min);
      const max=Number(el.max);
      const val=Number(el.value);
      if(!isFinite(min)||!isFinite(max)||max===min) return 0;
      return ((val-min)/(max-min))*100;
    }
    function setRangePct(el, touched){
      const pct = touched ? pctOfRange(el) : 0;
      el.style.setProperty('--pct', `${pct}%`);
    }
    function syncRangeVisuals(){
      setRangePct(feeMin, feeMinTouched);
      setRangePct(feeMax, feeMaxTouched);
    }

    function getActiveSportsSet(){
      return (inFilterSheet && sheetSports) ? sheetSports : sportsSelected;
    }

    function snapshotFilters(){
      return {
        q:q.value,idq:idq.value,district:districtSel.value,
        feeMin:feeMin.value,feeMax:feeMax.value,feeBand:feeBand.value,
        genderPref:genderPrefSel.value,sortDate:sortDateSel.value,
        sports:Array.from(getActiveSportsSet()),
        feeMinTouched, feeMaxTouched
      };
    }
    function restoreFilters(state){
      if(!state) return;
      q.value=state.q??'';
      idq.value=state.idq??'';
      districtSel.value=state.district??'';
      genderPrefSel.value=state.genderPref??'';
      sortDateSel.value=state.sortDate??'desc';

      if(state.feeMin!=null) feeMin.value=String(state.feeMin);
      if(state.feeMax!=null) feeMax.value=String(state.feeMax);
      feeBand.value=state.feeBand??'';

      feeMinTouched = !!state.feeMinTouched;
      feeMaxTouched = !!state.feeMaxTouched;

      let min=Number(feeMin.value), max=Number(feeMax.value);
      if(min>max){[min,max]=[max,min]; feeMin.value=String(min); feeMax.value=String(max);}
      feeLabel.textContent=`HK$ ${min} – ${max}`;
      syncRangeVisuals();

      /* ✅ CHANGED: restore sports into committed + (if in sheet) draft */
      sportsSelected.clear();
      (state.sports||[]).forEach(s=>sportsSelected.add(s));
      if(inFilterSheet){
        sheetSports = new Set(state.sports||[]);
      }else{
        sheetSports = null;
      }

      renderActiveBar();
    }

    function updateFeeLabelFromSliders(){
      let min=Number(feeMin.value), max=Number(feeMax.value);
      if(min>max){[min,max]=[max,min]; feeMin.value=String(min); feeMax.value=String(max);}
      feeLabel.textContent=`HK$ ${min} – ${max}`;
      syncRangeVisuals();
    }

    function initFees(){
      const fees=data.map(x=>x.fee).filter(x=>typeof x==='number');
      const min=Math.min(...fees,0);
      const max=Math.max(...fees,500);
      const lo=Math.floor(min/10)*10;
      const hi=Math.ceil(max/10)*10;

      feeMin.min=feeMax.min=String(lo);
      feeMin.max=feeMax.max=String(hi);

      feeMin.value=String(lo);
      feeMax.value=String(hi);
      feeLabel.textContent=`HK$ ${feeMin.value} – ${feeMax.value}`;
      feeBand.value="";

      feeMinTouched=false;
      feeMaxTouched=false;
      syncRangeVisuals();
    }

    function getSportDraftSet(){ return sportDraft || getActiveSportsSet(); }
    function updateSportSelCount(){
      const set=getSportDraftSet();
      sportSelCount.textContent=`已選：${set.size} 種運動`;
    }
    function renderSportList(){
      const set=getSportDraftSet();
      sportList.innerHTML='';
      SPORTS.forEach((s,i)=>{
        const id=`sport-${i}`;
        const label=document.createElement('label');
        label.innerHTML=`<input type="checkbox" id="${id}"> <span>${esc(s)}</span>`;
        const input=label.querySelector('input');
        input.checked=set.has(s);
        input.addEventListener('change',()=>{
          if(!sportDraft) sportDraft=new Set(getActiveSportsSet());
          if(input.checked) sportDraft.add(s);
          else sportDraft.delete(s);
          updateSportSelCount();
        });
        sportList.appendChild(label);
      });
      updateSportSelCount();
    }
    function openSportModal(){
      /* ✅ CHANGED: open with draft set (sheetSports) when in 篩選頁 */
      sportDraft=new Set(getActiveSportsSet());
      renderSportList();
      sportBackdrop.classList.add('show');
      sportBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      sportClose.focus();
    }
    function closeSportModal(){
      sportDraft=null;
      sportBackdrop.classList.remove('show');
      sportBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
      if(returnToFilterAfterSport && window.innerWidth<=560){
        returnToFilterAfterSport=false;
        resumeFilterSheet();
      }
    }
    sportSelAll.addEventListener('click',()=>{
      if(!sportDraft) sportDraft=new Set(getActiveSportsSet());
      SPORTS.forEach(s=>sportDraft.add(s));
      renderSportList();
    });
    sportClrAll.addEventListener('click',()=>{
      if(!sportDraft) sportDraft=new Set(getActiveSportsSet());
      sportDraft.clear();
      renderSportList();
    });
    applySport.addEventListener('click',()=>{
      /* ✅ CHANGED (as ordered):
         - if in 篩選頁 (sheet), store to sheetSports only (NOT applied yet)
         - otherwise, apply immediately (desktop) */
      if(inFilterSheet){
        sheetSports = new Set(sportDraft || new Set());
        sportDraft=null;
        closeSportModal();
        return;
      }

      sportsSelected.clear();
      (sportDraft||new Set()).forEach(s=>sportsSelected.add(s));
      sportDraft=null;
      currentPage=1;
      refresh();
      closeSportModal();
    });
    if(sportBtn) sportBtn.addEventListener('click',openSportModal);
    sportClose.addEventListener('click',closeSportModal);
    sportBackdrop.addEventListener('click',(e)=>{ if(e.target===sportBackdrop) closeSportModal(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && sportBackdrop.classList.contains('show')) closeSportModal(); });

    function passesFee(c){
      const fee=Number(c.fee??0);
      const band=feeBand.value;
      if(band){
        if(band==="0-100") return fee>=0 && fee<=100;
        if(band==="100-200") return fee>=100 && fee<=200;
        if(band==="200-300") return fee>=200 && fee<=300;
        if(band==="300-400") return fee>=300 && fee<=400;
        if(band==="400+") return fee>400;
      }
      let min=Number(feeMin.value), max=Number(feeMax.value);
      if(min>max){[min,max]=[max,min]; feeMin.value=String(min); feeMax.value=String(max);}
      feeLabel.textContent=`HK$ ${min} – ${max}`;
      syncRangeVisuals();
      return fee>=min && fee<=max;
    }
    function passesDistrict(c){ const d=districtSel.value; if(!d) return true; return c.district===d; }
    function passesSports(c){
      if(sportsSelected.size===0) return true;
      if(!Array.isArray(c.sports)||c.sports.length===0) return false;
      return c.sports.some(s=>sportsSelected.has(s));
    }
    function passesGender(c){
      const g=genderPrefSel.value;
      if(!g) return true;
      const pref=(c.tutorGenderPref||'').trim();
      if(g==='male') return pref==='男'||pref==='皆可';
      if(g==='female') return pref==='女'||pref==='皆可';
      return true;
    }
    function passesKeyword(c){
      const k=q.value.trim().toLowerCase();
      if(!k) return true;
      const hay=[c.id,c.name,c.age,c.experience,c.district,c.venue,c.notes,c.schedule,c.startDate,c.postedDate,
        c.tutorGenderPref||"", (c.fee??"")+"",(c.weeklyLessons??"")+"",(c.lessonLength??"")+"", ...(c.sports||[])
      ].join(' ').toLowerCase();
      return hay.includes(k);
    }
    function passesId(c){
      const s=idq.value.trim();
      if(!s) return true;
      return (c.id||'').toLowerCase().includes(s.toLowerCase());
    }
    function applyFilters(){
      return data.filter(c=>passesFee(c)&&passesDistrict(c)&&passesSports(c)&&passesGender(c)&&passesKeyword(c)&&passesId(c));
    }
    function sortByPosted(arr){
      const mode=sortDateSel.value;
      if(mode==='rand') return shuffle(arr);
      return arr.slice().sort((a,b)=>{
        const ta=a._ts||0, tb=b._ts||0;
        return mode==='asc' ? (ta-tb) : (tb-ta);
      });
    }

    function renderActiveBar(){
      const chips=Array.from(sportsSelected).map(s=>({sport:s}));
      if(chips.length===0){ activeBar.classList.add('hidden'); activeBar.innerHTML=''; return; }
      activeBar.classList.remove('hidden');
      activeBar.innerHTML=`<span class="mini">運動：</span>`;
      for(const c of chips){
        const chip=document.createElement('span');
        chip.className='chip';
        chip.innerHTML=`<button class="x" title="移除此篩選" data-sport="${esc(c.sport)}">×</button><span>${esc(c.sport)}</span>`;
        activeBar.appendChild(chip);
      }
    }
    activeBar.addEventListener('click',(e)=>{
      const btn=e.target.closest('button.x');
      if(!btn) return;
      const s=btn.getAttribute('data-sport');
      sportsSelected.delete(s);
      currentPage=1; refresh();
    });

    function renderList(){
      grid.setAttribute('aria-busy','true');
      grid.innerHTML='';
      const total=view.length;
      const totalPages=Math.max(1, Math.ceil(total / PAGE_SIZE));
      currentPage=Math.min(Math.max(1,currentPage), totalPages);

      const start=(currentPage-1)*PAGE_SIZE;
      const end=Math.min(start+PAGE_SIZE, total);
      const pageSlice=view.slice(start,end);

      if(pageSlice.length===0){
        const empty=document.createElement('div');
        empty.className='empty';
        empty.textContent='找不到符合條件的案例。請調整篩選或清除搜尋。';
        grid.appendChild(empty);
      }else{
        for(const c of pageSlice){
          const card=document.createElement('article');
          card.className='card'; card.tabIndex=0;
          const initials=esc((c.name||'?').slice(0,2));
          const avatarColor=colorFromName(c.name||'');
          card.innerHTML=`
            <div class="top">
              <div class="avatar" style="background:${avatarColor};" aria-hidden="true">${initials}</div>
              <div class="who">
                <div class="name">${esc(c.name)}　<small style="color:var(--muted)">${esc(c.age ? c.age + ' 歲' : '')}</small></div>
                <div class="muted">案件編號：${esc(c.id || '-') }</div>
              </div>
            </div>

            <div class="row">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 11h18M6 7h12M6 15h12M5 21l2-6m10 6l2-6" stroke="var(--accent)" stroke-width="1.4" stroke-linecap="round"/></svg>
              <span>${esc((c.sports||[]).join('、') || '—')}</span>
            </div>

            <div class="row">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 20s8-4.5 8-11a8 8 0 1 0-16 0c0 6.5 8 11 8 11Z" stroke="var(--accent)" stroke-width="1.4"/><circle cx="12" cy="9" r="2" fill="var(--accent)"/></svg>
              <span>${esc(c.district || '—')}</span>
            </div>

            <div class="row">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 7h16M4 12h16M4 17h10" stroke="var(--accent)" stroke-width="1.4"/></svg>
              <span>場地：${esc(c.venue || '—')}</span>
            </div>

            <div class="tags">
              <span class="tag">導師性別偏好：${esc(c.tutorGenderPref || '皆可')}</span>
              <span class="tag">學費：HK$ ${esc(c.fee ?? '—')}/時</span>
              <span class="tag">張貼：${esc(c._dateStr || '—')}</span>
              ${c.schedule ? `<span class="tag">${esc(c.schedule)}</span>`:''}
              ${c.startDate ? `<span class="tag">開始：${esc(c.startDate)}</span>`:''}
            </div>

            ${c.notes ? `<p class="note">${esc(c.notes)}</p>`:''}

            <div class="foot">
              <span>點擊查看完整個案</span>
              <span class="budget">${(c.fee || c.fee===0) ? `HK$ ${esc(c.fee)}/時` : '面議'}</span>
            </div>
          `;
          card.addEventListener('click',()=>openProfile(c));
          card.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault();openProfile(c);} });
          grid.appendChild(card);
        }
      }

      const shownFrom= total===0 ? 0 : (start+1);
      const shownTo=end;
      countEl.textContent=`符合 ${total} 個招聘個案　·　顯示第 ${shownFrom}–${shownTo} 個招聘個案`;

      pageInfo.textContent=`第 ${currentPage} / ${Math.max(1, Math.ceil(total / PAGE_SIZE))} 頁`;
      grid.removeAttribute('aria-busy');
    }

    function refresh(){
      view=applyFilters();
      view=sortByPosted(view);
      renderList();
      renderActiveBar();
    }

    let openedCase=null;
    function openProfile(c){
      openedCase=c;
      modalAvatar.style.background=colorFromName(c.name||'?');
      modalAvatar.textContent=(c.name||'?').slice(0,2);

      /* ✅ CHANGED (as ordered): remove “（XX歲）” in detail profile title */
      modalTitle.textContent=`${c.name ?? '—'}`;

      modalSub.textContent=`案件編號：${c.id ?? '—'}`;

      kvBasic.innerHTML=`
        <b>年齡</b><div>${esc(c.age ?? '—')}</div>
        <b>相關經驗</b><div>${esc(c.experience ?? '—')}</div>
        <b>期望上課地區</b><div>${esc(c.district ?? '—')}</div>
        <b>場地安排</b><div>${esc(c.venue ?? '—')}</div>
        <b>運動種類</b><div>${esc((c.sports||[]).join('、') || '—')}</div>
        <b>張貼日期</b><div>${esc(c._dateStr || '—')}</div>
      `;
      kvExpect.innerHTML=`
        <b>期望學費</b><div>HK$ ${esc(c.fee ?? '—')} / 小時</div>
        <b>每週堂數</b><div>${esc(c.weeklyLessons ?? '—')} 堂 / 週</div>
        <b>每堂時數</b><div>${esc(c.lessonLength ?? '—')} 小時 / 堂</div>
        <b>導師性別偏好</b><div>${esc(c.tutorGenderPref || '皆可')}</div>
        <b>可開始日期</b><div>${esc(c.startDate ?? '—')}</div>
        <b>時段偏好</b><div>${esc(c.schedule ?? '—')}</div>
      `;
      kvNotes.textContent=c.notes || '—';
      copyIdBtn.textContent='複製案件編號';

      backdrop.classList.add('show');
      backdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      modalClose.focus();
    }
    function closeProfile(){
      openedCase=null;
      backdrop.classList.remove('show');
      backdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }
    modalClose.addEventListener('click',closeProfile);
    backdrop.addEventListener('click',(e)=>{ if(e.target===backdrop) closeProfile(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && backdrop.classList.contains('show')) closeProfile(); });

    copyIdBtn.addEventListener('click', async ()=>{
      if(!openedCase) return;
      const text=openedCase.id || '';
      const ok=await copyToClipboard(text);
      copyIdBtn.textContent= ok ? '已複製！' : '複製失敗，請手動';
    });

    function moveFiltersToSheet(){
      if(filtersInSheet) return;

      filterPanelBody.insertBefore(filtersSection, mobileSportRow);
      filtersInSheet=true;

      /* ✅ CHANGED (as ordered): put 運動種類篩選 at the bottom of 篩選條件 (in mobile sheet) */
      if(mobileSportRow && mobileSportRow.parentNode !== filtersSection){
        filtersSection.appendChild(mobileSportRow);
      }
    }
    function restoreFiltersHome(){
      if(!filtersInSheet) return;

      if(mobileSportHomeNextSibling && mobileSportHomeNextSibling.parentNode === mobileSportHomeParent){
        mobileSportHomeParent.insertBefore(mobileSportRow, mobileSportHomeNextSibling);
      }else{
        mobileSportHomeParent.appendChild(mobileSportRow);
      }

      if(filtersHomeNextSibling && filtersHomeNextSibling.parentNode === filtersHomeParent){
        filtersHomeParent.insertBefore(filtersSection, filtersHomeNextSibling);
      }else{
        filtersHomeParent.appendChild(filtersSection);
      }
      filtersInSheet=false;
    }

    function suspendFilterSheet(){
      filterBackdrop.classList.remove('show');
      filterBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }
    function resumeFilterSheet(){
      if(window.innerWidth>560) return;
      moveFiltersToSheet();
      filterBackdrop.classList.add('show');
      filterBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      inFilterSheet=true;
    }

    function openFilterSheet(){
      if(window.innerWidth>560) return;

      /* ✅ CHANGED (as ordered): draft mode starts here, store snapshot + draft sports */
      sheetSnapshot=snapshotFilters();
      sheetSports = new Set(sportsSelected);

      inFilterSheet=true;

      moveFiltersToSheet();
      filterBackdrop.classList.add('show');
      filterBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
    }
    function closeFilterSheet(commit=false){
      if(!commit){
        /* ✅ CHANGED (as ordered): discard draft (including ticks) */
        restoreFilters(sheetSnapshot);
      }else{
        sheetSnapshot=snapshotFilters();
      }

      inFilterSheet=false;
      sheetSports=null;

      if(window.innerWidth>560){
        restoreFiltersHome();
      }
      filterBackdrop.classList.remove('show');
      filterBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }

    if(filterOpenBtn) filterOpenBtn.addEventListener('click',openFilterSheet);
    if(filterCloseBtn) filterCloseBtn.addEventListener('click',()=>closeFilterSheet(false));
    if(filterApplyBtn){
      filterApplyBtn.addEventListener('click',()=>{
        /* ✅ CHANGED: commit draft sports before refresh */
        if(sheetSports){
          sportsSelected.clear();
          sheetSports.forEach(s=>sportsSelected.add(s));
        }
        currentPage=1;
        refresh();
        closeFilterSheet(true);
      });
    }
    if(filterBackdrop){
      filterBackdrop.addEventListener('click',(e)=>{
        if(e.target===filterBackdrop) closeFilterSheet(false);
      });
    }
    /* ✅ CHANGED (as ordered): ESC exits 篩選頁 without applying */
    document.addEventListener('keydown',(e)=>{
      if(e.key==='Escape' && filterBackdrop.classList.contains('show')){
        closeFilterSheet(false);
      }
    });

    if(mobileSportBtn){
      mobileSportBtn.addEventListener('click',()=>{
        returnToFilterAfterSport=true;
        suspendFilterSheet();
        openSportModal();
      });
    }

    window.addEventListener('resize',()=>{
      if(window.innerWidth>560 && filtersInSheet){
        restoreFilters(sheetSnapshot);
        inFilterSheet=false;
        sheetSports=null;

        restoreFiltersHome();
        filterBackdrop.classList.remove('show');
        filterBackdrop.setAttribute('aria-hidden','true');
        document.body.style.overflow='';
      }
    });

    document.getElementById('shuffle').addEventListener('click',()=>{
      sortDateSel.value='rand';
      currentPage=1;
      refresh();
    });

    document.getElementById('resetAll').addEventListener('click',()=>{
      q.value=''; idq.value=''; districtSel.value='';
      genderPrefSel.value='';
      sportsSelected.clear();
      sortDateSel.value='desc';
      initFees();
      currentPage=1;
      refresh();
    });

    q.addEventListener('input',()=>{ if(inFilterSheet) return; currentPage=1; refresh(); });
    idq.addEventListener('input',()=>{ if(inFilterSheet) return; currentPage=1; refresh(); });
    districtSel.addEventListener('change',()=>{ if(inFilterSheet) return; currentPage=1; refresh(); });

    feeMin.addEventListener('input',()=>{
      feeMinTouched=true;
      updateFeeLabelFromSliders();
      if(inFilterSheet) return;
      currentPage=1; refresh();
    });
    feeMax.addEventListener('input',()=>{
      feeMaxTouched=true;
      updateFeeLabelFromSliders();
      if(inFilterSheet) return;
      currentPage=1; refresh();
    });

    feeBand.addEventListener('change',()=>{ if(inFilterSheet) return; currentPage=1; refresh(); });
    genderPrefSel.addEventListener('change',()=>{ if(inFilterSheet) return; currentPage=1; refresh(); });
    sortDateSel.addEventListener('change',()=>{ if(inFilterSheet) return; currentPage=1; refresh(); });

    prevPageBtn.addEventListener('click',()=>{ if(currentPage>1){ currentPage--; renderList(); }});
    nextPageBtn.addEventListener('click',()=>{
      const totalPages=Math.max(1, Math.ceil(view.length / PAGE_SIZE));
      if(currentPage<totalPages){ currentPage++; renderList(); scrollToTop(); }
    });

    function boot(){
      data=shuffle(data);
      initFees();
      sortDateSel.value='desc';
      refresh();
    }
    (function ready(fn){
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded',fn,{once:true});
      else fn();
    })(boot);
  </script>
</body>
</html>
