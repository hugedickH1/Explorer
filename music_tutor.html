<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ✅ CHANGED (as ordered): page name -->
  <title>尋找導師 （音樂）</title>

  <!-- ✅ Font: makes spacing same across devices -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      /* ✅ follow your reference (black bg + midnight purple cards + pale purple buttons) */
      --bg: #000000;
      --card: #1a1033;
      --muted: #94A3B8;
      --text: #0f172a;
      --ring: #dbeafe;
      --accent: #0ea5e9;

      --shadow: 0 8px 22px rgba(15,23,42,.08);
      --radius: 16px;
      --modalBg: rgba(2,6,23,.35);

      /* ✅ tags match reference dark theme */
      --tagBg: rgba(167,139,250,.14);
      --tagBorder: rgba(196,181,253,.26);
      --tagText: #FFFFFF;
      --glassBlur: 14px;
    }

    /* =========================================================
       ✅ CROSS-BROWSER CONSISTENCY LAYER (ONLY FIXES)
       - Keep your design the same, but prevent Safari/Firefox/iOS weird styling
       ========================================================= */
    *{box-sizing:border-box}
    html,body{height:100%}
    html{ scroll-behavior: smooth; }

    html{
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif, -apple-system, "Noto Sans TC", system-ui, "PingFang TC", "Microsoft JhengHei", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x:hidden;

      /* ✅ remove ugly mobile tap flash */
      -webkit-tap-highlight-color: transparent;
    }

    /* ✅ normalize buttons / inputs across browsers */
    button, input, select, textarea{
      font: inherit;
      letter-spacing: inherit;
    }

    /* ✅ remove Safari default button styles (but YOUR .btn will re-style it) */
    button{
      appearance:none;
      -webkit-appearance:none;
    }
    button::-moz-focus-inner{ border:0; padding:0; }

    /* ✅ remove iOS search input UI */
    input[type="search"]{
      appearance:none;
      -webkit-appearance:none;
    }
    input[type="search"]::-webkit-search-decoration,
    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-results-button,
    input[type="search"]::-webkit-search-results-decoration{
      -webkit-appearance:none;
      display:none;
    }

    /* ✅ unify select styling */
    select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;

      /* ✅ keep your look, but arrow becomes consistent */
      background-image:
        linear-gradient(45deg, transparent 50%, #0f172a 50%),
        linear-gradient(135deg, #0f172a 50%, transparent 50%);
      background-position:
        calc(100% - 18px) calc(50% - 2px),
        calc(100% - 12px) calc(50% - 2px);
      background-size:6px 6px, 6px 6px;
      background-repeat:no-repeat;
      padding-right:40px;
    }
    /* ========================================================= */

    .container{max-width:1200px; margin:26px auto 80px; padding:0 20px;}

    .topbar{
      position: sticky;
      top: 0;
      z-index: 30;
      backdrop-filter: blur(var(--glassBlur));
      -webkit-backdrop-filter: blur(var(--glassBlur));
      background: rgba(255,255,255,.06);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .topbar-inner{
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .logo{
      width: 40px; height: 40px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      display:grid; place-items:center;
      flex: 0 0 auto;
      color: rgba(248,250,252,.92);
    }
    .logo svg{ width: 22px; height: 22px; }
    .logo svg path{ stroke: currentColor !important; }

    .brandText{
      line-height: 1.05;
      min-width: 0;
    }
    .brandText .title{
      font-weight: 950;
      letter-spacing: .12em;
      font-size: 13px;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .brandText .sub{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .menuBtn{
      width: 44px;
      height: 44px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      color: rgba(248,250,252,.92);
      cursor:pointer;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .menuBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.20);
      background: rgba(255,255,255,.07);
    }
    .menuBtn:active{ transform: translateY(0) scale(.99); }
    .menuBtn svg{ width: 22px; height: 22px; }
    .menuBtn svg path{ stroke: currentColor !important; }

    .overlay{
      position: fixed;
      inset: 0;
      background: var(--modalBg);
      opacity: 0;
      pointer-events: none;
      transition: opacity .22s ease;
      z-index: 40;
    }
    .overlay.open{
      opacity: 1;
      pointer-events: auto;
    }

    .drawer{
      position: fixed;
      top: 0;
      right: 0;
      height: 100%;
      width: min(92vw, 360px);
      transform: translateX(105%);
      transition: transform .28s cubic-bezier(.2,.8,.2,1);
      z-index: 50;

      background: rgba(255,255,255,.06);
      border-left: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: -18px 0 60px rgba(0,0,0,.45);
      overflow: hidden;
    }
    .drawer.open{ transform: translateX(0); }

    .drawer::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(520px 240px at 20% 20%, rgba(167,139,250,.12), transparent 60%),
        radial-gradient(520px 260px at 90% 30%, rgba(56,189,248,.22), transparent 60%),
        radial-gradient(560px 340px at 60% 90%, rgba(167,139,250,.12), transparent 70%);
      opacity:.9;
      pointer-events:none;
    }

    .drawerInner{
      position: relative;
      height: 100%;
      display:flex;
      flex-direction:column;
      padding: 16px 16px 14px;
      gap: 12px;
    }

    .drawerTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 6px;
    }
    .drawerTitle{
      font-weight: 800;
      letter-spacing: .08em;
      font-size: 13px;
      text-transform: uppercase;
      color: rgba(248,250,252,.92);
    }

    .closeBtn{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(248,250,252,.92);
      cursor:pointer;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .closeBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.20);
      background: rgba(255,255,255,.08);
    }
    .closeBtn:active{ transform: translateY(0) scale(.98); }
    .closeBtn svg{ width: 18px; height: 18px; }
    .closeBtn svg path{ stroke: currentColor !important; }

    .navList{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .navItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      text-decoration:none;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(248,250,252,.94);
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .navItem:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
    }
    .navLeft{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }
    .navMain{
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .navArrow{
      width: 28px;
      height: 28px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      flex: 0 0 auto;
    }
    .navArrow svg{ width: 16px; height: 16px; color: rgba(248,250,252,.92); }
    .navArrow svg path{ stroke: currentColor !important; }

    .drawerFoot{
      margin-top: auto;
      font-size: 12px;
      color: rgba(226,232,240,.78);
      padding: 10px 12px 6px;
    }

    @media (max-width: 720px){
      .topbar-inner{ padding: 10px 14px; }
    }

    header:not(.topbar){
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .title{display:flex; align-items:center; gap:10px;}
    .title h1{
      margin:0; font-size:clamp(20px,2.3vw,28px); letter-spacing:.4px;
      background:linear-gradient(90deg,#0f172a,#0369a1);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    .toolbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--ring);
      background:#EDE9FE; /* ✅ pale purple */
      color:#0f172a;
      cursor:pointer;
      transition: transform .06s ease, border-color .2s, background .2s;
      box-shadow:var(--shadow);
      white-space:nowrap;
      font-size:14px;

      /* ✅ cross-browser button height alignment */
      line-height:1;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }
    .btn:hover{ border-color:#C4B5FD; background:#DDD6FE }
    .btn:active{ transform: scale(.98);}

    /* ✅ ONLY these top buttons: 音樂及樂器分類篩選 / 重新隨機 / 重設所有篩選 / (phone) 篩選 */
    .topbtn{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.18);
      color: #F8FAFC;
    }
    .topbtn:hover{
      background: rgba(255,255,255,.14);
      border-color: #a78bfa;
    }
    /* ✅ phone filter icon color (override inline stroke) */
    #filterOpen .filter-icon svg path{ stroke:#F8FAFC !important; }

    .filter-btn{display:none;}          /* 手機才顯示 */
    .desktop-only{display:inline-flex;}

    .filter-icon{
      display:inline-flex;
      width:16px; height:16px;
      margin-right:6px;
    }
    .filter-icon svg{width:100%; height:100%; display:block;}

    /* 篩選 + 搜尋外層 */
    .filter-row{
      margin:16px 0 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .filters,
    .search-row{
      display:grid;
      gap:10px;
    }
    .filters .field,
    .search-row .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .gender-field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .label{font-size:12px; color:#334155}
    .mini{font-size:12px; color:#334155}

    /* ✅ words on (black) background -> white */
    .filter-row .label,
    .filter-row .mini{ color:#FFFFFF; }
    .meta{ color:#FFFFFF; }
    .pageinfo{ color:#FFFFFF; }

    select, input[type="search"], input[type="text"]{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--ring); background:#fff; color:var(--text);
      box-shadow:var(--shadow); outline:none; transition:border-color .2s, box-shadow .2s;
      font-size:14px;
    }
    select:focus, input:focus{ border-color: var(--accent); box-shadow:0 0 0 3px rgba(14,165,233,.18) }

    .slider-row{display:flex; gap:16px; align-items:flex-start}
    .slider-col{display:flex; flex-direction:column; gap:6px; flex:1}

    /* ✅ Slider + bar colour: follow your description exactly */
    .slider-col input[type="range"]{
      width:100%;
      -webkit-appearance:none;
      appearance:none;
      height:16px;
      background:transparent;
      margin:0;
      padding:0;

      /* ✅ CHANGED (as ordered): fill = #a78bfa */
      --fill: #a78bfa;
      /* default (before user touches) will be forced to 0% by JS */
      --pct: 0%;
      cursor:pointer;
    }
    .slider-col input[type="range"]::-webkit-slider-runnable-track{
      height:6px;
      border-radius:999px;
      background:
        linear-gradient(to right,
          var(--fill) 0%,
          var(--fill) var(--pct),
          #ffffff var(--pct),
          #ffffff 100%
        );
      /* ✅ CHANGED (as ordered): border = rgba(167,139,250,.75) */
      border:1px solid rgba(167,139,250,.75);
      box-shadow:none;
    }
    .slider-col input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:16px;
      height:16px;
      border-radius:999px;
      background:#a78bfa;
      border:2px solid rgba(255,255,255,.88);
      box-shadow:0 8px 18px rgba(0,0,0,.45);
      margin-top:-6px; /* center on 6px track */
      cursor:pointer;
    }
    .slider-col input[type="range"]::-moz-range-track{
      height:6px;
      border-radius:999px;
      background:
        linear-gradient(to right,
          var(--fill) 0%,
          var(--fill) var(--pct),
          #ffffff var(--pct),
          #ffffff 100%
        );
      /* ✅ CHANGED (as ordered): border = rgba(167,139,250,.75) */
      border:1px solid rgba(167,139,250,.75);
      box-shadow:none;
    }
    .slider-col input[type="range"]::-moz-range-thumb{
      width:16px;
      height:16px;
      border-radius:999px;
      background:#a78bfa;
      border:2px solid rgba(255,255,255,.88);
      box-shadow:0 8px 18px rgba(0,0,0,.45);
      cursor:pointer;
    }
    .slider-col input[type="range"]:focus-visible{ outline:none; }

    /* 手機用價位下拉 */
    #feeBand{
      display:none;
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--ring);
      background:#fff;
      box-shadow:var(--shadow);
      color:#0f172a;
    }

    .meta{display:flex; align-items:center; gap:10px; margin:10px 2px 18px; font-size:14px;}

    .grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:16px;}
    @media (max-width:980px){ .grid{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:560px){ .grid{grid-template-columns: 1fr;} }

    .card{
      background: var(--card);
      border:1px solid rgba(196,181,253,.22);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
      transition: transform .15s ease, border-color .2s;
      cursor:pointer;
    }
    .card:hover{ transform: translateY(-3px); border-color: rgba(196,181,253,.55) }
    .card:focus{ outline: none; border-color: rgba(196,181,253,.75); box-shadow:0 0 0 3px rgba(167,139,250,.28) }

    .top{display:flex; align-items:center; gap:12px; margin-bottom:10px;}
    .avatar{
      width:38px; height:38px; border-radius:50%; display:grid; place-items:center; color:#fff; font-weight:800; letter-spacing:.5px;
      border: 1px solid rgba(2,6,23,.08);
      overflow:hidden;
    }
    .who{display:flex; flex-direction:column; gap:3px;}
    .who .name{font-weight:700; color: rgba(248,250,252,.96);}
    .who .muted{color: rgba(226,232,240,.78); font-size:13px}
    .who .name small{ color: rgba(226,232,240,.78) !important; }

    .row{display:flex; align-items:center; gap:8px; margin:8px 0; color: rgba(226,232,240,.92); font-size:14px}
    .row svg{opacity:.95}

    /* ✅ icons -> purple like reference */
    .card .row svg path{ stroke:#a78bfa !important; }
    .card .row svg circle{ fill:#a78bfa !important; }

    .tags{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
    .tag{
      font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--tagBorder); background:var(--tagBg); color:var(--tagText);
    }

    .foot{margin-top:12px; display:flex; align-items:center; justify-content:space-between; gap:8px; color: rgba(226,232,240,.68); font-size:13px;}
    .budget{color:#FFFFFF; font-weight:700}
    .note{margin-top:10px; color: rgba(226,232,240,.84); font-size:14px; line-height:1.5}
    .empty{grid-column:1/-1; text-align:center; padding:40px 16px; color:#64748b; border:1px dashed var(--ring); border-radius:var(--radius); background:#fff}

    .modal-backdrop{
      position:fixed; inset:0; background:var(--modalBg);
      display:none; align-items:center; justify-content:center;
      z-index:50; padding:16px;
    }
    .modal-backdrop.show{display:flex}

    /* ✅ make Subject modal cover Filter sheet */
    #subjectBackdrop{ z-index: 70; }

    .modal{
      width:min(920px, 96vw); max-height:90vh; overflow:auto; background:#ffffff;
      border:1px solid var(--ring); border-radius:22px; box-shadow: 0 25px 70px rgba(0,0,0,.20);
      position:relative;
    }
    .modal header{
      padding:18px 20px 0 20px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      position:relative;
    }

    /* === 使用「學術版」風格的 立即申請 按鈕 === */
    .apply-btn{
      padding:8px 16px;
      border-radius:999px;
      border:none;
      background:#22c55e;
      color:#ffffff;
      font-size:14px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      box-shadow:var(--shadow);
      transition:background .15s ease, transform .06s ease, box-shadow .15s ease;
      white-space:nowrap;
      line-height:1;
      touch-action: manipulation;
    }
    .modal header .apply-btn{ margin-right:40px; }
    .apply-btn:hover{ background:#16a34a; }
    .apply-btn:active{
      transform:scale(.97);
      box-shadow:0 4px 14px rgba(22,163,74,.35);
    }

    .modal .body{padding: 4px 20px 20px}
    .modal .close{
      border:none;
      background:transparent;
      color:#1e40af;
      cursor:pointer;
      font-size:22px;
      position:absolute;
      top:14px;
      right:18px;
      line-height:1;
    }

    .profile-grid{
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap:18px;
      margin-top:6px;
      justify-items:stretch;
    }
    .profile-card{
      background:#f8fafc;
      border:1px solid var(--ring);
      border-radius:16px;
      padding:14px;
    }
    .profile-title{margin:0 0 8px 0; font-size:15px; color:#0369a1}
    .kv{display:grid; grid-template-columns: 120px 1fr; gap:8px 12px; font-size:14px}
    .kv b{color:#0f172a; font-weight:600}
    .cta-row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .copy{cursor:pointer; border:1px solid var(--ring); background:#ffffff; color:#0f172a; padding:8px 10px; border-radius:10px; box-shadow:var(--shadow); line-height:1}
    .copy:hover{border-color:#93c5fd; background:#f0f9ff}

    /* ✅ 手機：搜尋兩格一行 */
    @media (max-width:560px){
      .filters{ grid-template-columns:1fr; }
      .search-row{ grid-template-columns:repeat(2,minmax(0,1fr)); }

      .slider-row, #feeLabel{ display:none; }
      #feeBand{ display:block; }

      .profile-grid{ grid-template-columns:1fr; justify-items:center; }
      .profile-card{ max-width:520px; width:100%; }
    }

    .pager{display:flex; align-items:center; justify-content:center; gap:10px; margin-top:16px; flex-wrap:wrap}
    .pagebtn{border:1px solid var(--ring); background:#fff; padding:8px 12px; border-radius:10px; cursor:pointer; line-height:1}
    .pagebtn[disabled]{opacity:.5; cursor:not-allowed}
    .pageinfo{font-size:13px; color:#FFFFFF} /* ✅ CHANGED: make 第 1 / 1 頁 white */

    /* 手機 toolbar + filter bottom sheet 樣式 */
    @media (max-width:560px){
      .toolbar{
        width:100%;
        display:grid;
        grid-template-columns: repeat(2, minmax(0,1fr));
        gap:8px;
        margin-top:8px;
      }
      .toolbar .btn{ width:100%; }
      #resetAll{ grid-column:1 / -1; }
      .filter-btn{ display:inline-flex; }
      .desktop-only{display:none;}

      /* 手機版：主畫面唔直接顯示 filters，會移入 bottom sheet */
      .filters{ display:none; }

      .filter-panel .filters{
        display:grid;
        grid-template-columns:1fr;
        gap:10px;
        margin:0; /* ✅ keep uniform spacing */
      }

      .fee-label{ font-size:0; }
      .fee-label::before{
        content:"價位區間";
        font-size:12px;
        color:#334155;
      }
    }

    /* Filter bottom sheet */
    .filter-panel{
      width:100%;
      max-width:640px;
      margin:0 auto;
      background:#f8fafc;
      border-radius:18px 18px 0 0;
      box-shadow:0 -16px 40px rgba(15,23,42,.3);
    }
    .filter-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:16px 18px 6px;
    }
    .filter-title{
      margin:0;
      font-size:18px;
      color:#0f172a;
    }
    .filter-header-right{
      display:flex;
      align-items:center;
      gap:8px;
    }

    /* ✅ 套用篩選 button matches desktop .btn style */
    .filter-apply-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:12px;
      border:1px solid rgba(196,181,253,.35);
      background:#EDE9FE;
      color:#0f172a;
      font-size:14px;
      cursor:pointer;
      white-space:nowrap;
      box-shadow:var(--shadow);
      transition: transform .06s ease, border-color .2s, background .2s;
      line-height:1;
      touch-action: manipulation;
    }
    .filter-apply-btn:hover{ background:#DDD6FE; border-color:#C4B5FD; }
    .filter-apply-btn:active{ transform: scale(.98); }

    .filter-close{
      border:none;
      background:transparent;
      font-size:24px;
      cursor:pointer;
      color:#0f172a;
      line-height:1;
    }

    .filter-body{
      padding:4px 18px 14px;
      display:flex;
      flex-direction:column;
      gap:10px; /* ✅ uniform spacing between fields */
    }

    @media (max-width:560px){
      #filterBackdrop.modal-backdrop{
        align-items:flex-end;
        justify-content:center;
        padding:0;
      }
    }

    /* 桌機：5 欄同一行 */
    @media (min-width:561px){
      .filter-btn{display:none;}
      .desktop-only{display:inline-flex;}
      #filterBackdrop{display:none !important;}
      .filters{display:grid;}

      .filter-row{
        display:grid;
        grid-template-columns: 1.1fr 1.1fr 1.1fr 1.1fr 1.1fr;
        gap:10px;
        align-items:flex-start;
        margin:16px 0 12px;
      }

      .filter-row .filters,
      .filter-row .search-row{
        display:contents;
        margin:0;
      }

      .filter-row .label,
      .filter-row .mini{ white-space:nowrap; }

      .filter-row .filters .field:nth-child(1){ grid-column:1; grid-row:1; }
      .filter-row .filters .field:nth-child(2){ grid-column:2; grid-row:1; }
      .filter-row .filters .field:nth-child(3){ grid-column:5; grid-row:1; }
      .filter-row .search-row .field:nth-child(1){ grid-column:3; grid-row:1; }
      .filter-row .search-row .field:nth-child(2){ grid-column:4; grid-row:1; }
    }

    /* 樂器分類篩選 Modal */
    .subgrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:8px 12px;
      margin-top:10px;
    }
    .subgrid label{display:flex; gap:8px; align-items:center; font-size:13px; color:#0f172a}
    .subgrid input{width:16px; height:16px}
    .bar{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px}
    .fw{width:100%}
    @media (max-width:560px){
      .subgrid{
        grid-template-columns:1fr;
        max-height:260px;
        overflow-y:auto;
        padding-right:4px;
      }
      .subgrid label span{
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }
    }

    /* =========================
       Banner ONLY — follow your reference banner format
       ========================= */
    .banner{
      position:relative;
      width:100%;
      border-radius:22px;
      overflow:hidden;
      padding:22px 20px;
      margin-bottom:14px;

      --accentBanner: #a78bfa;

      border:1.2px solid transparent;
      background:
        radial-gradient(700px 220px at 12% 20%, rgba(167,139,250,.22), transparent 62%) padding-box,
        radial-gradient(520px 220px at 85% 35%, rgba(196,181,253,.14), transparent 65%) padding-box,
        linear-gradient(135deg, #1a1033 0%, #140a2b 45%, #0f071f 100%) padding-box,

        linear-gradient(135deg,
          rgba(167,139,250,.72) 0%,
          rgba(196,181,253,.50) 45%,
          rgba(167,139,250,.46) 100%
        ) border-box;

      box-shadow:
        0 10px 26px rgba(15,23,42,.10),
        0 1px 0 rgba(255,255,255,.10) inset;
    }

    .banner::before{
      content:"";
      position:absolute;
      inset:1px;
      border-radius:21px;
      background:
        radial-gradient(520px 200px at 18% 10%, rgba(255,255,255,.16), transparent 60%),
        radial-gradient(420px 220px at 85% 0%, rgba(255,255,255,.10), transparent 62%);
      opacity:.60;
      pointer-events:none;
    }
    .banner::after{
      content:"";
      position:absolute;
      inset:1px;
      border-radius:21px;
      background: linear-gradient(180deg, transparent 55%, rgba(2,6,23,.22) 100%);
      pointer-events:none;
    }

    .banner-inner{
      position:relative;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .banner-title{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:280px;
    }

    .logo-wrap{
      width:46px; height:46px;
      border-radius:14px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(196,181,253,.24);
      box-shadow: 0 8px 18px rgba(15,23,42,.22);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position:relative;

      /* ✅ CHANGED (as ordered): prevent shrinking on phone */
      flex: 0 0 46px;
      flex-shrink: 0;
    }
    .logo-wrap::before{
      content:"";
      position:absolute; inset:-10px;
      border-radius:18px;
      background: radial-gradient(circle at 50% 50%, rgba(167,139,250,.22), transparent 62%);
      pointer-events:none;
    }

    .banner-icon{ width:28px; height:28px; position:relative; z-index:1; flex-shrink:0; } /* ✅ keep icon size */
    .banner-icon path{
      stroke:#c4b5fd;
      stroke-width:1.7;
      stroke-linecap:round;
      stroke-linejoin:round;
    }
    .banner-icon{
      filter:
        drop-shadow(0 6px 12px rgba(0,0,0,.30))
        drop-shadow(0 0 10px rgba(167,139,250,.16));
    }

    .banner-text h1{
      margin:0;
      font-size:clamp(22px, 2.5vw, 30px);
      letter-spacing:.3px;
      line-height:1.08;
      color: rgba(248,250,252,.96);
    }
    .banner-text h1 .accent{
      color: var(--accentBanner, #a78bfa);
      font-weight:900;
    }
    .banner-text p{
      margin:7px 0 0;
      color: rgba(226,232,240,.82);
      font-size:13.5px;
      line-height:1.45;
      max-width:680px;
    }

    /* ✅ Tablet: buttons UNDER title/subtitle */
    @media (min-width:561px) and (max-width:980px){
      .banner-inner{
        flex-direction:column;
        align-items:flex-start;
      }
      .banner .toolbar{
        width:100%;
        justify-content:flex-start;
        margin-top:14px;
      }
    }

    /* ✅ Desktop: buttons UNDER title/subtitle */
    @media (min-width:981px){
      .banner{
        padding:30px 28px;
        margin-bottom:26px;
      }
      .banner-inner{
        flex-direction:column;
        align-items:flex-start;
      }
      .banner .toolbar{
        width:100%;
        justify-content:flex-start;
        margin-top:14px;
      }
    }

    /* ✅ ONLY colour: Subject modal + Filter sheet + Profile modal -> black bg + white text */
    #backdrop .modal{
      background:#000000;
      border:1px solid rgba(255,255,255,.18);
      color:#FFFFFF;
    }
    #backdrop .modal header{ color:#FFFFFF; }
    #backdrop .modal .close{ color:#FFFFFF !important; }
    #backdrop .profile-card{
      background:#000000;
      border:1px solid rgba(255,255,255,.18);
      color:#FFFFFF;
    }
    #backdrop .profile-title{ color:#FFFFFF !important; }
    #backdrop .kv,
    #backdrop .kv div,
    #backdrop #kv-notes{ color:#FFFFFF !important; }
    #backdrop .kv b{
      color:#FFFFFF !important;
      font-weight:600;
    }
    #backdrop .copy{
      background:#FFFFFF;
      border:1px solid rgba(196,181,253,.26);
      color:#0f172a;
    }
    #backdrop .copy:hover{
      background:#F8FAFC;
      border-color: rgba(196,181,253,.55);
    }

    #subjectBackdrop .modal{
      background:#000000;
      border:1px solid rgba(255,255,255,.18);
      color:#FFFFFF;
    }
    #subjectBackdrop #subjectTitle{ color:#FFFFFF !important; }
    #subjectBackdrop .close{ color:#FFFFFF !important; }
    #subjectBackdrop .mini,
    #subjectBackdrop .subgrid label{ color:#FFFFFF !important; }

    #filterBackdrop .filter-panel{
      background:#000000;
      border:1px solid rgba(255,255,255,.18);
    }
    #filterBackdrop .filter-title,
    #filterBackdrop .filter-close,
    #filterBackdrop .label,
    #filterBackdrop .mini{ color:#FFFFFF !important; }
    #filterBackdrop .fee-label::before{ color:#FFFFFF !important; }
    #filterBackdrop select,
    #filterBackdrop input[type="search"],
    #filterBackdrop input[type="text"],
    #filterBackdrop #feeBand{
      border-color: rgba(255,255,255,.18);
    }

    /* ✅ make label ↔ button spacing same as other fields (6px) */
    #filterBackdrop .mobile-subject-row{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    /* ✅ phone filter sheet "開啟音樂及樂器分類篩選" button looks like a white input box */
    #filterBackdrop #mobileSubjectBtn{
      width:100%;
      display:block;
      padding:10px 12px;
      border-radius:12px;
      background:#FFFFFF;
      color:#0f172a;
      border:1px solid rgba(255,255,255,.18);
      box-shadow:var(--shadow);
      text-align:left;
      justify-content:flex-start;
      font-size:14px;
      line-height:1;
      touch-action: manipulation;
    }
    #filterBackdrop #mobileSubjectBtn:hover{
      background:#FFFFFF;
      border-color: rgba(255,255,255,.18);
    }
    #filterBackdrop #mobileSubjectBtn:active{
      transform:none; /* keep it input-like */
    }
  </style>
</head>

<body>
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M3.5 11.5 21 3.5l-8 17-2.5-6-7-3Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M21 3.5 10.5 14.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="brandText">
          <div class="title">EXPLORER</div>
          <div class="sub">尋找導師（學術）</div>
        </div>
      </div>

      <button class="menuBtn" id="menuBtn" type="button" aria-label="開啟導航列" aria-controls="drawer" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 7h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M5 17h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <nav class="drawer" id="drawer" aria-label="導航列" aria-hidden="true">
    <div class="drawerInner">
      <div class="drawerTop">
        <div class="drawerTitle">導航</div>
        <button class="closeBtn" id="closeBtn" type="button" aria-label="關閉導航列">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="navList">
        <a class="navItem" href="/index.html">
          <div class="navLeft"><div class="navMain">主頁</div></div>
          <div class="navArrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </a>

        <a class="navItem" href="/index.html#flowPanel">
          <div class="navLeft"><div class="navMain">配對方法</div></div>
          <div class="navArrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </a>

        <a class="navItem" href="/fees.html">
          <div class="navLeft"><div class="navMain">收費及付款詳情</div></div>
          <div class="navArrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </a>

        <a class="navItem" href="/contact.html">
          <div class="navLeft"><div class="navMain">聯絡我們</div></div>
          <div class="navArrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </a>

        <a class="navItem" href="/terms.html">
          <div class="navLeft"><div class="navMain">使用條款</div></div>
          <div class="navArrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </a>
      </div>

      <div class="drawerFoot">
        點擊空白位置或按 ESC 可關閉導航列。
      </div>
    </div>
  </nav>
  <div class="container">

    <!-- ✅ Banner (follow reference banner format) -->
    <div class="banner">
      <div class="banner-inner">
        <div class="banner-title">
          <span class="logo-wrap" aria-hidden="true">
            <!-- music note quaver -->
            <svg class="banner-icon" viewBox="0 0 24 24" fill="none">
              <path d="M9 19a2 2 0 1 0 0-4a2 2 0 0 0 0 4Z"/>
              <path d="M11 15V6"/>
              <path d="M11 6c4 1 6 3 6 6"/>
            </svg>
          </span>

          <div class="banner-text">
            <!-- ✅ CHANGED (as ordered): page name -->
            <h1>尋找導師 <span class="accent">（音樂）</span></h1>
            <p>提供音樂及樂器導師，協助學生建立音樂基礎與興趣</p>
          </div>
        </div>

        <div class="toolbar">
          <button id="filterOpen" class="btn topbtn filter-btn">
            <span class="filter-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M4 5h16M7 11h10M10 17h4" stroke="#0f172a" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            篩選
          </button>

          <button id="subjectBtn" class="btn topbtn desktop-only">音樂及樂器分類篩選</button>
          <button id="shuffle" class="btn topbtn">重新隨機</button>
          <button id="resetAll" class="btn topbtn">重設所有篩選</button>
        </div>
      </div>
    </div>

    <section class="filter-row" aria-label="篩選與搜尋">
      <div class="filters" aria-label="篩選條件">
        <div class="field">
          <span class="label">上課及授課地區 / 網上授課</span>
          <select id="district">
            <option value="">全部地區</option>
            <option>網上授課</option>
            <option>中西區</option><option>灣仔區</option><option>東區</option><option>南區</option>
            <option>油尖旺區</option><option>深水埗區</option><option>九龍城區</option><option>黃大仙區</option><option>觀塘區</option>
            <option>葵青區</option><option>荃灣區</option><option>屯門區</option><option>元朗區</option><option>北區</option><option>大埔區</option>
            <option>沙田區</option><option>西貢區</option><option>離島區</option>
          </select>
        </div>

        <div class="field">
          <span class="label fee-label">價位區間（HK$/小時）</span>

          <div class="slider-row">
            <div class="slider-col">
              <span class="mini">價位下限</span>
              <input id="feeMin" type="range" min="0" max="800" step="10" />
            </div>
            <div class="slider-col">
              <span class="mini">價位上限</span>
              <input id="feeMax" type="range" min="0" max="800" step="10" />
            </div>
          </div>
          <div class="label" id="feeLabel">HK$ 0 – 800</div>

          <select id="feeBand">
            <option value="">全部價位</option>
            <option value="0-100">HK$0–100/小時</option>
            <option value="100-200">HK$100–200/小時</option>
            <option value="200-300">HK$200–300/小時</option>
            <option value="300-400">HK$300–400/小時</option>
            <option value="400+">HK$400 以上/小時</option>
          </select>
        </div>

        <div class="field gender-field">
          <span class="label">導師性別篩選</span>
          <select id="genderFilter">
            <option value="">不限導師性別</option>
            <option value="男導師">男導師</option>
            <option value="女導師">女導師</option>
          </select>
        </div>
      </div>

      <div class="search-row" aria-label="搜尋">
        <div class="field">
          <span class="label">關鍵字搜尋</span>
          <input id="q" type="search" placeholder="導師姓名 / 樂器 / 經驗 / 學歷 / 備註…" />
        </div>

        <div class="field">
          <span class="label">導師編號</span>
          <input id="idq" type="text" placeholder="輸入編號（如：MU-202511-003）" />
        </div>
      </div>
    </section>

    <div class="meta" id="count">載入中…</div>

    <section id="grid" class="grid" aria-live="polite" aria-busy="true"></section>

    <div class="pager">
      <button id="prevPage" class="pagebtn">上一頁</button>
      <span id="pageInfo" class="pageinfo">第 1 / 1 頁</span>
      <button id="nextPage" class="pagebtn">下一頁</button>
    </div>
  </div>

  <div id="backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <header>
        <div class="title" style="gap:10px">
          <div id="modalAvatar" class="avatar" style="width:44px;height:44px"></div>
          <div>
            <h2 id="modalTitle" style="margin:0; font-size:20px"></h2>
            <div id="modalSub" class="who muted" style="margin-top:4px"></div>
          </div>
        </div>
        <a
          href="https://forms.gle/E746boJXjZvdT4fN6"
          target="_blank"
          rel="noopener noreferrer"
          class="apply-btn"
        >立即申請！</a>
        <button class="close" id="modalClose" aria-label="關閉">✕</button>
      </header>
      <div class="body">
        <div class="profile-grid">
          <div class="profile-card">
            <h3 class="profile-title">基本資料</h3>
            <div class="kv" id="kv-basic"></div>
            <div class="cta-row">
              <button id="copyId" class="copy">複製導師編號</button>
            </div>
          </div>
          <div class="profile-card">
            <h3 class="profile-title">課程資料</h3>
            <div class="kv" id="kv-expect"></div>
          </div>
          <div class="profile-card" style="grid-column:1/-1">
            <h3 class="profile-title">備註 / 自我介紹</h3>
            <div id="kv-notes" style="white-space:pre-wrap; line-height:1.7; font-size:14px"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="subjectBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="subjectTitle">
      <header>
        <h2 id="subjectTitle" style="margin:0; font-size:20px; color:#0369a1">音樂及樂器分類篩選</h2>
        <button class="close" id="subjectClose" aria-label="關閉">✕</button>
      </header>
      <div class="body">
        <div class="mini">勾選樂器 / 項目（可複選）；未勾選即不限樂器種類</div>
        <div id="subjectList" class="subgrid" style="margin-top:12px"></div>
        <div class="bar">
          <button id="subjectSelAll" class="btn">全選</button>
          <button id="subjectClrAll" class="btn">清除全部</button>
          <span id="subjectSelCount" class="mini fw">已選：0 個項目</span>
        </div>
        <div class="bar" style="justify-content:flex-end; margin-top:12px">
          <button id="applySubject" class="btn">套用篩選</button>
        </div>
      </div>
    </div>
  </div>

  <div id="filterBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="filter-panel" role="document" aria-labelledby="filterTitle">
      <div class="filter-header">
        <h2 id="filterTitle" class="filter-title">篩選條件</h2>
        <div class="filter-header-right">
          <button id="filterApply" class="filter-apply-btn">套用篩選</button>
          <button id="filterClose" class="filter-close" aria-label="關閉">✕</button>
        </div>
      </div>
      <div class="filter-body" id="filterPanelBody">
        <div class="field mobile-subject-row">
          <span class="label">音樂及樂器分類篩選</span>
          <button id="mobileSubjectBtn" class="btn" style="padding-inline:12px">開啟音樂及樂器分類篩選</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const menuBtn = document.getElementById('menuBtn');
      const drawer  = document.getElementById('drawer');
      const overlay = document.getElementById('overlay');
      const closeBtn= document.getElementById('closeBtn');

      if(!menuBtn || !drawer || !overlay || !closeBtn) return;
      let lastFocus = null;

      function openNav(){
        lastFocus = document.activeElement;
        drawer.classList.add('open');
        overlay.classList.add('open');
        drawer.setAttribute('aria-hidden','false');
        overlay.setAttribute('aria-hidden','false');
        menuBtn.setAttribute('aria-expanded','true');
        closeBtn.focus({ preventScroll:true });
      }

      function closeNav(){
        drawer.classList.remove('open');
        overlay.classList.remove('open');
        drawer.setAttribute('aria-hidden','true');
        overlay.setAttribute('aria-hidden','true');
        menuBtn.setAttribute('aria-expanded','false');
        if(lastFocus && typeof lastFocus.focus === 'function'){
          lastFocus.focus({ preventScroll:true });
        }else{
          menuBtn.focus({ preventScroll:true });
        }
      }

      menuBtn.addEventListener('click', () => {
        const isOpen = drawer.classList.contains('open');
        if(isOpen) closeNav(); else openNav();
      });

      closeBtn.addEventListener('click', closeNav);
      overlay.addEventListener('click', closeNav);

      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape' && drawer.classList.contains('open')){
          closeNav();
        }
      });

      drawer.addEventListener('click', (e)=>{
        const a = e.target.closest('a');
        if(a) closeNav();
      });
    })();

    const SUBJECTS = [
      "鋼琴 Piano","小提琴 Violin","大提琴 Cello","結他 Guitar","烏克麗麗 Ukulele",
      "木鼓 Drums","歌唱聲樂 Vocal","薩克斯風 Saxophone","單簧管 Clarinet","長笛 Flute",
      "樂理 Music Theory","其他"
    ];

    const TEACHERS = [
      {
        id:"MU-202511-001",
        name:"Kelvin Sir",
        gender:"男導師",
        years:"8 年",
        mainCategory:"鋼琴導師",
        instruments:["鋼琴 Piano"],
        district:"沙田區",
        areaDetail:"沙田 / 大圍 附近琴行或上門",
        fee:380,
        mode:"面授為主，如有需要可網上上課",
        targetLevels:["初學者","ABRSM Grade 1–5"],
        experience:"多年教授兒童及青少年，熟悉 ABRSM 考試流程及要求。",
        qualification:"音樂系畢業，已考獲 ABRSM 鋼琴演奏級",
        timeSlots:"一三五 晚上；週末日間",
        notes:"課堂會同時重視讀譜、節奏感同技巧，會按學生性格及目標調整教材，例如考試路線或純興趣。"
      },
      {
        id:"MU-202511-002",
        name:"Carmen",
        gender:"女導師",
        years:"6 年",
        mainCategory:"小提琴導師",
        instruments:["小提琴 Violin"],
        district:"灣仔區",
        areaDetail:"灣仔 / 銅鑼灣 文化中心附近或上門",
        fee:420,
        mode:"面授個別 / 小組教學",
        targetLevels:["小學","初中","校際音樂節備戰"],
        experience:"帶過多位學生參加校際音樂節及弦樂團試音，熟悉拉琴姿勢及音色控制訓練。",
        qualification:"ABRSM 小提琴八級，音樂教育文憑",
        timeSlots:"平日放學後；週六下午",
        notes:"以放鬆、自然運弓為主，避免因用力過度造成肩頸不適，會配合簡單視唱練耳練習。"
      },
      {
        id:"MU-202511-003",
        name:"Marcus",
        gender:"男導師",
        years:"5 年",
        mainCategory:"鼓班導師",
        instruments:["木鼓 Drums"],
        district:"荃灣區",
        areaDetail:"荃灣 鼓房 / Band 房",
        fee:350,
        mode:"面授一對一，另設 Band 課",
        targetLevels:["小學高年級","中學","成人興趣"],
        experience:"曾為多隊中學 band 做鼓手指導，熟悉 Pop、Rock 同 Worship 風格。",
        qualification:"流行音樂專業文憑，曾任職琴行導師",
        timeSlots:"週末下午；部份平日晚上",
        notes:"注重節奏穩定同 Groove 感，會用學生喜歡嘅歌去做練習，增加練鼓動力。"
      },
      {
        id:"MU-202511-004",
        name:"Yuki",
        gender:"女導師",
        years:"4 年",
        mainCategory:"結他 / Ukulele 導師",
        instruments:["結他 Guitar","烏克麗麗 Ukulele"],
        district:"中西區",
        areaDetail:"中環 / 上環 咖啡店附近或上門",
        fee:320,
        mode:"面授為主，可視像教學",
        targetLevels:["中學","大專","成人興趣"],
        experience:"專教自彈自唱，擅長幫學生改編適合自己音域的 key 同編曲。",
        qualification:"流行音樂課程畢業，多年街頭表演及婚禮演出經驗",
        timeSlots:"二四 晚上；週日 下午",
        notes:"主打流行歌自彈自唱，同學生一齊揀歌練習，亦會教授基本樂理，幫助之後自學。"
      },
      {
        id:"MU-202511-005",
        name:"Ryan",
        gender:"男導師",
        years:"7 年",
        mainCategory:"樂理導師",
        instruments:["樂理 Music Theory"],
        district:"網上授課",
        areaDetail:"以網上 Zoom / Meet 上課",
        fee:450,
        mode:"網上小班 / 一對一",
        targetLevels:["ABRSM Grade 5","ABRSM Grade 8"],
        experience:"專門處理樂理考試及補底，學生整體合格率高。",
        qualification:"音樂系碩士，已完成相關樂理師資訓練",
        timeSlots:"平日晚上；週六 上午",
        notes:"以歷屆試題配合重點筆記，幫學生建構系統概念，而非死背題目。"
      },
      {
        id:"MU-202511-006",
        name:"Zoey",
        gender:"女導師",
        years:"3 年",
        mainCategory:"兒童音樂啟蒙",
        instruments:["鋼琴 Piano","歌唱聲樂 Vocal"],
        district:"元朗區",
        areaDetail:"元朗 / 天水圍 上門或會所琴房",
        fee:260,
        mode:"面授一對一 / 小組 (2–3人)",
        targetLevels:["幼稚園 K2–K3","小一–小三"],
        experience:"熟悉幼兒教學，曾於幼稚園教授音樂遊戲班。",
        qualification:"幼兒教育證書，鋼琴八級",
        timeSlots:"平日下午；六 上午",
        notes:"課堂以遊戲方式帶小朋友接觸節奏、音高同簡單樂器，著重建立對音樂嘅興趣。"
      }
    ];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    function esc(str){
      return String(str ?? "").replace(/[&<>"'`=\/]/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'
      }[s]));
    }
    function colorFromName(name){
      let h=0;
      for(let i=0;i<name.length;i++){
        h = (h*31 + name.charCodeAt(i)) % 360;
      }
      return `hsl(${h} 70% 50%)`;
    }
    function scrollToTop(){
      try{ window.scrollTo({top:0,behavior:'smooth'});}catch{ window.scrollTo(0,0);}
    }
    async function copyTextFallback(text){
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.setAttribute('readonly','');
      ta.style.position = 'fixed';
      ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.select();
      let ok = false;
      try { ok = document.execCommand('copy'); } catch(e) { ok = false; }
      document.body.removeChild(ta);
      return ok;
    }
    async function copyToClipboard(text){
      try{
        if (navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          return true;
        }
      }catch(e){}
      return await copyTextFallback(text);
    }

    /* ✅ slider fill helper */
    function setRangeFill(r){
      if(!r) return;
      const min = Number(r.min ?? 0);
      const max = Number(r.max ?? 100);
      const val = Number(r.value ?? 0);
      const pct = (max === min) ? 0 : ((val - min) / (max - min)) * 100;
      r.style.setProperty('--pct', `${Math.max(0, Math.min(100, pct))}%`);
    }

    const grid = document.getElementById('grid');
    const countEl = document.getElementById('count');
    const q = document.getElementById('q');
    const idq = document.getElementById('idq');
    const districtSel = document.getElementById('district');
    const feeMin = document.getElementById('feeMin');
    const feeMax = document.getElementById('feeMax');
    const feeLabel = document.getElementById('feeLabel');
    const feeBand = document.getElementById('feeBand');
    const genderFilter = document.getElementById('genderFilter');

    const backdrop = document.getElementById('backdrop');
    const modalClose = document.getElementById('modalClose');
    const modalAvatar = document.getElementById('modalAvatar');
    const modalTitle = document.getElementById('modalTitle');
    const modalSub = document.getElementById('modalSub');
    const kvBasic = document.getElementById('kv-basic');
    const kvExpect = document.getElementById('kv-expect');
    const kvNotes = document.getElementById('kv-notes');
    const copyIdBtn = document.getElementById('copyId');

    const PAGE_SIZE = 9;
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');
    const pageInfo = document.getElementById('pageInfo');

    const subjectBtn = document.getElementById('subjectBtn');
    const subjectBackdrop = document.getElementById('subjectBackdrop');
    const subjectClose = document.getElementById('subjectClose');
    const subjectList = document.getElementById('subjectList');
    const subjectSelAll = document.getElementById('subjectSelAll');
    const subjectClrAll = document.getElementById('subjectClrAll');
    const subjectSelCount = document.getElementById('subjectSelCount');
    const applySubject = document.getElementById('applySubject');

    const filterBackdrop = document.getElementById('filterBackdrop');
    const filterOpenBtn = document.getElementById('filterOpen');
    const filterCloseBtn = document.getElementById('filterClose');
    const filterApplyBtn = document.getElementById('filterApply');
    const filterPanelBody = document.getElementById('filterPanelBody');
    const mobileSubjectBtn = document.getElementById('mobileSubjectBtn');
    const filtersSection = document.querySelector('.filters');
    const mobileSubjectRow = document.querySelector('.mobile-subject-row');
    const filtersHomeParent = filtersSection.parentNode;
    const filtersHomeNextSibling = filtersSection.nextElementSibling;

    let currentPage = 1;
    let data = TEACHERS.slice();
    let view = data.slice();
    let openedTeacher = null;

    const subjectsSelected = new Set();

    /* ✅ Subject modal draft (only commit when pressing its apply; on mobile filter sheet, final commit happens on filter sheet apply) */
    let subjectDraft = null;
    let subjectModalFromSheet = false;

    /* ✅ Mobile filter sheet draft for subjects (only commit when press 篩選條件「套用篩選」) */
    let sheetSubjectsDraft = null;

    let filtersInSheet = false;

    /* ✅ slider touched flags */
    let feeMinTouched = false;
    let feeMaxTouched = false;

    /* ✅ Mobile sheet snapshot: close without apply => revert */
    let sheetSnapshot = null;
    let suppressSheetEvents = false;

    function isFilterSheetOpen(){
      return (window.innerWidth <= 560) && filterBackdrop.classList.contains('show');
    }

    function snapshotSheetState(){
      return {
        district: districtSel.value,
        feeMin: feeMin.value,
        feeMax: feeMax.value,
        feeBand: feeBand.value,
        gender: genderFilter.value,
        feeMinTouched,
        feeMaxTouched
      };
    }

    function syncFeeLabelAndFill(){
      let min = Number(feeMin.value), max = Number(feeMax.value);
      if(min > max){
        [min, max] = [max, min];
        feeMin.value = String(min);
        feeMax.value = String(max);
      }
      feeLabel.textContent = `HK$ ${min} – ${max}`;
      if(feeMinTouched) setRangeFill(feeMin); else feeMin.style.setProperty('--pct','0%');
      if(feeMaxTouched) setRangeFill(feeMax); else feeMax.style.setProperty('--pct','0%');
    }

    function restoreSheetState(s){
      if(!s) return;
      suppressSheetEvents = true;

      districtSel.value = s.district ?? '';
      feeMin.value = String(s.feeMin ?? feeMin.value);
      feeMax.value = String(s.feeMax ?? feeMax.value);
      feeBand.value = s.feeBand ?? '';
      genderFilter.value = s.gender ?? '';

      feeMinTouched = !!s.feeMinTouched;
      feeMaxTouched = !!s.feeMaxTouched;

      syncFeeLabelAndFill();

      suppressSheetEvents = false;
    }

    function initFees(){
      const fees = data.map(x=>x.fee).filter(x=>typeof x==='number');
      const min = Math.min(...fees, 0);
      const max = Math.max(...fees, 800);
      const lo = Math.floor(min/10)*10;
      const hi = Math.ceil(max/10)*10;
      feeMin.min = feeMax.min = String(lo);
      feeMin.max = feeMax.max = String(hi);
      feeMin.value = String(lo);
      feeMax.value = String(hi);
      feeLabel.textContent = `HK$ ${feeMin.value} – ${feeMax.value}`;
      feeBand.value = "";

      feeMinTouched = false;
      feeMaxTouched = false;
      feeMin.style.setProperty('--pct','0%');
      feeMax.style.setProperty('--pct','0%');
    }

    function updateSubjectSelCount(){
      subjectSelCount.textContent = `已選：${subjectDraft ? subjectDraft.size : 0} 個項目`;
    }

    function renderSubjectList(){
      subjectList.innerHTML = '';
      SUBJECTS.forEach((s, i)=>{
        const id = `subject-${i}`;
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" id="${id}"> <span>${esc(s)}</span>`;
        const input = label.querySelector('input');

        input.checked = subjectDraft ? subjectDraft.has(s) : false;

        input.addEventListener('change', ()=>{
          if(!subjectDraft) return;
          if(input.checked) subjectDraft.add(s);
          else subjectDraft.delete(s);
          updateSubjectSelCount();
        });

        subjectList.appendChild(label);
      });
      updateSubjectSelCount();
    }

    function openSubjectModal(fromSheet=false){
      subjectModalFromSheet = !!fromSheet;

      if(subjectModalFromSheet){
        /* ✅ draft starts from sheet draft (NOT applied filters) */
        subjectDraft = new Set(sheetSubjectsDraft || subjectsSelected);
      } else {
        /* ✅ desktop: draft starts from applied selection */
        subjectDraft = new Set(subjectsSelected);
      }

      renderSubjectList();
      subjectBackdrop.classList.add('show');
      subjectBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      subjectClose.focus();
    }

    function closeSubjectModal(){
      subjectDraft = null;
      subjectModalFromSheet = false;

      subjectBackdrop.classList.remove('show');
      subjectBackdrop.setAttribute('aria-hidden','true');

      /* ✅ if filter sheet is still open, keep locked */
      document.body.style.overflow = isFilterSheetOpen() ? 'hidden' : '';
    }

    subjectSelAll.addEventListener('click', ()=>{
      if(!subjectDraft) return;
      SUBJECTS.forEach(s=>subjectDraft.add(s));
      renderSubjectList();
    });

    subjectClrAll.addEventListener('click', ()=>{
      if(!subjectDraft) return;
      subjectDraft.clear();
      renderSubjectList();
    });

    applySubject.addEventListener('click', ()=>{
      if(!subjectDraft) return;

      if(subjectModalFromSheet){
        /* ✅ in 篩選 page flow: only save to sheet draft (NOT apply to list yet) */
        sheetSubjectsDraft = new Set(subjectDraft);
        closeSubjectModal();
        return; /* stay in filter sheet */
      }

      /* ✅ desktop (or not from sheet): apply immediately */
      subjectsSelected.clear();
      subjectDraft.forEach(s=>subjectsSelected.add(s));
      closeSubjectModal();

      currentPage = 1;
      refresh();
    });

    if(subjectBtn){ subjectBtn.addEventListener('click', ()=>openSubjectModal(false)); }
    subjectClose.addEventListener('click', closeSubjectModal);
    subjectBackdrop.addEventListener('click', (e)=>{ if(e.target === subjectBackdrop) closeSubjectModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && subjectBackdrop.classList.contains('show')) closeSubjectModal(); });

    function passesFee(c){
      const fee = Number(c.fee ?? 0);
      const band = feeBand.value;

      if(band){
        if(band === "0-100")   return fee >= 0   && fee <= 100;
        if(band === "100-200") return fee >= 100 && fee <= 200;
        if(band === "200-300") return fee >= 200 && fee <= 300;
        if(band === "300-400") return fee >= 300 && fee <= 400;
        if(band === "400+")    return fee > 400;
      }

      let min = Number(feeMin.value), max = Number(feeMax.value);
      if(min > max){
        [min, max] = [max, min];
        feeMin.value = String(min);
        feeMax.value = String(max);
      }
      feeLabel.textContent = `HK$ ${min} – ${max}`;

      if(feeMinTouched) setRangeFill(feeMin); else feeMin.style.setProperty('--pct','0%');
      if(feeMaxTouched) setRangeFill(feeMax); else feeMax.style.setProperty('--pct','0%');

      return fee >= min && fee <= max;
    }
    function passesDistrict(c){
      const d = districtSel.value;
      if(!d) return true;
      return c.district === d;
    }
    function passesGender(c){
      const g = genderFilter.value;
      if(!g) return true;
      return (c.gender || '') === g;
    }
    function passesSubjects(c){
      if(subjectsSelected.size === 0) return true;
      if(!Array.isArray(c.instruments) || c.instruments.length===0) return false;
      return c.instruments.some(s=>subjectsSelected.has(s));
    }
    function passesKeyword(c){
      const k = q.value.trim().toLowerCase();
      if(!k) return true;
      const hay = [
        c.id, c.name, c.gender, c.years, c.mainCategory,
        ...(c.instruments||[]),
        c.district, c.areaDetail, c.mode,
        ...(c.targetLevels||[]),
        c.experience, c.qualification, c.timeSlots, c.notes,
        (c.fee ?? "") + ""
      ].join(' ').toLowerCase();
      return hay.includes(k);
    }
    function passesId(c){
      const s = idq.value.trim();
      if(!s) return true;
      return (c.id||'').toLowerCase().includes(s.toLowerCase());
    }
    function applyFilters(){
      return data.filter(c =>
        passesFee(c) &&
        passesDistrict(c) &&
        passesGender(c) &&
        passesSubjects(c) &&
        passesKeyword(c) &&
        passesId(c)
      );
    }

    function renderList(){
      grid.setAttribute('aria-busy','true');
      grid.innerHTML = '';

      const total = view.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      currentPage = Math.min(Math.max(1, currentPage), totalPages);

      const start = (currentPage - 1) * PAGE_SIZE;
      const end = Math.min(start + PAGE_SIZE, total);
      const pageSlice = view.slice(start, end);

      if(pageSlice.length === 0){
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.textContent = '找不到符合條件的導師。請調整篩選或清除搜尋。';
        grid.appendChild(empty);
      } else {
        for(const c of pageSlice){
          const card = document.createElement('article');
          card.className = 'card';
          card.tabIndex = 0;
          const initials = esc((c.name||'?').slice(0,2));
          const avatarColor = colorFromName(c.name||'');

          card.innerHTML = `
            <div class="top">
              <div class="avatar" style="background:${avatarColor};" aria-hidden="true">${initials}</div>
              <div class="who">
                <div class="name">${esc(c.name)}　<small style="color:#334155">${esc(c.gender || '')}</small></div>
                <div class="muted">導師編號：${esc(c.id || '-') }</div>
              </div>
            </div>

            <div class="row">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M3 11h18M6 7h12M6 15h12M5 21l2-6m10 6l2-6" stroke="#3b82f6" stroke-width="1.4" stroke-linecap="round"/>
              </svg>
              <span>${esc((c.instruments||[]).join('、') || '—')}</span>
            </div>

            <div class="row">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 20s8-4.5 8-11a8 8 0 1 0-16 0c0 6.5 8 11 8 11Z" stroke="#3b82f6" stroke-width="1.4"/>
                <circle cx="12" cy="9" r="2" fill="#3b82f6"/>
              </svg>
              <span>${esc(c.district || '—')}</span>
            </div>

            <div class="row">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M4 7h16M4 12h16M4 17h10" stroke="#3b82f6" stroke-width="1.4"/>
              </svg>
              <span>${esc(c.mode || '—')}</span>
            </div>

            <div class="tags">
              <span class="tag">${esc(c.mainCategory || '—')}</span>
              ${(c.targetLevels && c.targetLevels.length)
                ? `<span class="tag">對象：${esc(c.targetLevels.join('、'))}</span>` : ''}
              <span class="tag">學費：HK$ ${esc(c.fee ?? '—')}/小時</span>
            </div>

            ${c.notes ? `<p class="note">${esc(c.notes)}</p>`:''}

            <div class="foot">
              <span>點擊查看完整導師資料</span>
              <span class="budget">${(c.fee || c.fee===0) ? `HK$ ${esc(c.fee)}/小時` : '面議'}</span>
            </div>
          `;
          card.addEventListener('click', ()=> openProfile(c));
          card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); openProfile(c); }});
          grid.appendChild(card);
        }
      }

      const shownFrom = total === 0 ? 0 : (start + 1);
      const shownTo = end;
      countEl.textContent = `符合 ${total} 位導師　·　顯示第 ${shownFrom}–${shownTo} 位`;

      pageInfo.textContent = `第 ${currentPage} / ${Math.max(1, Math.ceil(total / PAGE_SIZE))} 頁`;
      grid.removeAttribute('aria-busy');
    }

    function refresh(){
      view = applyFilters();
      renderList();
    }

    function openProfile(c){
      openedTeacher = c;
      modalAvatar.style.background = colorFromName(c.name||'?');
      modalAvatar.textContent = (c.name||'?').slice(0,2);

      modalTitle.textContent = `${c.name ?? '—'}`;
      modalSub.textContent = `導師編號：${c.id ?? '—'}`;

      kvBasic.innerHTML = `
        <b>教學年資</b><div>${esc(c.years ?? '—')}</div>
        <b>樂器 / 項目</b><div>${esc((c.instruments||[]).join('、') || '—')}</div>
        <b>服務地區</b><div>${esc(c.district ?? '—')}｜${esc(c.areaDetail ?? '')}</div>
        <b>授課模式</b><div>${esc(c.mode ?? '—')}</div>
      `;
      kvExpect.innerHTML = `
        <b>時薪</b><div>HK$ ${esc(c.fee ?? '—')} / 小時</div>
        <b>主要對象</b><div>${esc((c.targetLevels||[]).join('、') || '—')}</div>
        <b>教學經驗</b><div>${esc(c.experience ?? '—')}</div>
        <b>學歷 / 資格</b><div>${esc(c.qualification ?? '—')}</div>
        <b>可授課時間</b><div>${esc(c.timeSlots ?? '—')}</div>
      `;
      kvNotes.textContent = c.notes || '—';

      copyIdBtn.textContent = '複製導師編號';

      backdrop.classList.add('show');
      backdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      modalClose.focus();
    }
    function closeProfile(){
      openedTeacher = null;
      backdrop.classList.remove('show');
      backdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    modalClose.addEventListener('click', closeProfile);
    backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeProfile(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && backdrop.classList.contains('show')) closeProfile(); });

    copyIdBtn.addEventListener('click', async ()=>{
      if(!openedTeacher) return;
      const text = openedTeacher.id || '';
      const ok = await copyToClipboard(text);
      copyIdBtn.textContent = ok ? '已複製！' : '複製失敗，請手動';
    });

    function moveFiltersToSheet(){
      if(filtersInSheet) return;
      filterPanelBody.insertBefore(filtersSection, mobileSubjectRow);
      filtersInSheet = true;
    }
    function restoreFiltersHome(){
      if(!filtersInSheet) return;
      if(filtersHomeNextSibling && filtersHomeNextSibling.parentNode === filtersHomeParent){
        filtersHomeParent.insertBefore(filtersSection, filtersHomeNextSibling);
      } else {
        filtersHomeParent.appendChild(filtersSection);
      }
      filtersInSheet = false;
    }

    function openFilterSheet(){
      if(window.innerWidth > 560) return;

      /* ✅ snapshot applied state when opening sheet */
      sheetSnapshot = snapshotSheetState();

      /* ✅ start sheet subject draft from applied state */
      sheetSubjectsDraft = new Set(subjectsSelected);

      moveFiltersToSheet();
      filterBackdrop.classList.add('show');
      filterBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }

    function closeFilterSheet(applied=false){
      if(window.innerWidth > 560){ restoreFiltersHome(); }

      /* ✅ if not applied, revert UI to snapshot and discard drafts */
      if(!applied){
        restoreSheetState(sheetSnapshot);
        sheetSubjectsDraft = null;
      }

      sheetSnapshot = null;

      filterBackdrop.classList.remove('show');
      filterBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    if(filterOpenBtn){ filterOpenBtn.addEventListener('click', openFilterSheet); }
    if(filterCloseBtn){ filterCloseBtn.addEventListener('click', ()=>closeFilterSheet(false)); }

    if(filterApplyBtn){
      filterApplyBtn.addEventListener('click', ()=>{
        /* ✅ apply subject draft ONLY here */
        if(sheetSubjectsDraft){
          subjectsSelected.clear();
          sheetSubjectsDraft.forEach(s=>subjectsSelected.add(s));
        }

        currentPage = 1;
        refresh();
        closeFilterSheet(true);
      });
    }

    if(filterBackdrop){
      filterBackdrop.addEventListener('click', (e)=>{
        if(e.target === filterBackdrop) closeFilterSheet(false);
      });
    }

    /* ✅ ESC closes filter sheet without applying */
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Escape' && isFilterSheetOpen() && !subjectBackdrop.classList.contains('show') && !backdrop.classList.contains('show')){
        closeFilterSheet(false);
      }
    });

    if(mobileSubjectBtn){
      mobileSubjectBtn.addEventListener('click', ()=>{
        /* ✅ open subject modal INSIDE sheet flow (covers 篩選條件) */
        openSubjectModal(true);
      });
    }

    window.addEventListener('resize', ()=>{
      if(window.innerWidth > 560 && filtersInSheet){
        restoreFiltersHome();
        filterBackdrop.classList.remove('show');
        filterBackdrop.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
      }
    });

    document.getElementById('shuffle').addEventListener('click', ()=>{
      data = shuffle(data);
      currentPage = 1;
      refresh();
      scrollToTop();
    });

    document.getElementById('resetAll').addEventListener('click', ()=>{
      q.value = ''; idq.value = ''; districtSel.value = '';
      genderFilter.value = '';
      subjectsSelected.clear();
      sheetSubjectsDraft = null; /* keep clean */
      initFees();
      currentPage = 1;
      refresh();
    });

    q.addEventListener('input', ()=>{ currentPage=1; refresh(); });
    idq.addEventListener('input', ()=>{ currentPage=1; refresh(); });

    districtSel.addEventListener('change', ()=>{
      if(suppressSheetEvents) return;
      if(isFilterSheetOpen()) return; /* ✅ only apply when press 篩選條件「套用篩選」 */
      currentPage=1; refresh();
    });

    feeMin.addEventListener('input', ()=>{
      feeMinTouched = true;
      setRangeFill(feeMin);
      syncFeeLabelAndFill();

      if(suppressSheetEvents) return;
      if(isFilterSheetOpen()) return; /* ✅ only apply when press 篩選條件「套用篩選」 */
      currentPage=1; refresh();
    });
    feeMax.addEventListener('input', ()=>{
      feeMaxTouched = true;
      setRangeFill(feeMax);
      syncFeeLabelAndFill();

      if(suppressSheetEvents) return;
      if(isFilterSheetOpen()) return; /* ✅ only apply when press 篩選條件「套用篩選」 */
      currentPage=1; refresh();
    });

    feeBand.addEventListener('change', ()=>{
      if(suppressSheetEvents) return;
      if(isFilterSheetOpen()) return; /* ✅ only apply when press 篩選條件「套用篩選」 */
      currentPage=1; refresh();
    });

    genderFilter.addEventListener('change', ()=>{
      if(suppressSheetEvents) return;
      if(isFilterSheetOpen()) return; /* ✅ only apply when press 篩選條件「套用篩選」 */
      currentPage=1; refresh();
    });

    prevPageBtn.addEventListener('click', ()=>{
      if(currentPage>1){
        currentPage--;
        renderList();
      }
    });
    nextPageBtn.addEventListener('click', ()=>{
      const totalPages = Math.max(1, Math.ceil(view.length / PAGE_SIZE));
      if(currentPage < totalPages){
        currentPage++;
        renderList();
        scrollToTop();
      }
    });

    function boot(){
      data = shuffle(data);
      initFees();
      refresh();
    }
    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
